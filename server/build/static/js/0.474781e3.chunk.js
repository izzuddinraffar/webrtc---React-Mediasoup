(this.webpackJsonpwebrtc_mediasoup=this.webpackJsonpwebrtc_mediasoup||[]).push([[0],Array(93).concat([function(e,t,r){e.exports=r(121)},function(e,t,r){"use strict";var n=r(7),a=r(8);Object.defineProperty(t,"__esModule",{value:!0});var i=r(113),s="mediasoup-client",c=function(){function e(t){n(this,e),t?(this._debug=i.default("".concat(s,":").concat(t)),this._warn=i.default("".concat(s,":WARN:").concat(t)),this._error=i.default("".concat(s,":ERROR:").concat(t))):(this._debug=i.default(s),this._warn=i.default("".concat(s,":WARN")),this._error=i.default("".concat(s,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return a(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}();t.Logger=c},function(e,t){function r(e,t,r,n,a,i,s){try{var c=e[i](s),o=c.value}catch(d){return void r(d)}c.done?t(o):Promise.resolve(o).then(n,a)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var s=e.apply(t,n);function c(e){r(s,a,i,c,o,"next",e)}function o(e){r(s,a,i,c,o,"throw",e)}c(void 0)}))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clone=function(e,t){return"undefined"===typeof e?t:JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,r){"use strict";var n=r(50);Object.defineProperty(t,"__esModule",{value:!0});var a=r(128),i=r(96);function s(e){var t=new RegExp("^(audio|video)/(.+)","i");if("object"!==typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!==typeof e.mimeType)throw new TypeError("missing codec.mimeType");var r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!==typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!==typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!==typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"===typeof e.parameters||(e.parameters={});for(var a=0,i=Object.keys(e.parameters);a<i.length;a++){var s=i[a],o=e.parameters[s];if(void 0===o&&(e.parameters[s]="",o=""),"string"!==typeof o&&"number"!==typeof o)throw new TypeError("invalid codec parameter [key:".concat(s,"s, value:").concat(o,"]"));if("apt"===s&&"number"!==typeof o)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);var d,u=n(e.rtcpFeedback);try{for(u.s();!(d=u.n()).done;){c(d.value)}}catch(p){u.e(p)}finally{u.f()}}function c(e){if("object"!==typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!==typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"===typeof e.parameter||(e.parameter="")}function o(e){if("object"!==typeof e)throw new TypeError("ext is not an object");if(e.kind&&"string"===typeof e.kind||(e.kind=""),""!==e.kind&&"audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!==typeof e.uri)throw new TypeError("missing ext.uri");if("number"!==typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!==typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!==typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function d(e){if("object"!==typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!==typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");var t,r=n(e.codecs);try{for(r.s();!(t=r.n()).done;){u(t.value)}}catch(o){r.e(o)}finally{r.f()}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);var a,i=n(e.headerExtensions);try{for(i.s();!(a=i.n()).done;){p(a.value)}}catch(o){i.e(o)}finally{i.f()}if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);var s,c=n(e.encodings);try{for(c.s();!(s=c.n()).done;){l(s.value)}}catch(o){c.e(o)}finally{c.f()}if(e.rtcp&&"object"!==typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),f(e.rtcp)}function u(e){var t=new RegExp("^(audio|video)/(.+)","i");if("object"!==typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!==typeof e.mimeType)throw new TypeError("missing codec.mimeType");var r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!==typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!==typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!==typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"===typeof e.parameters||(e.parameters={});for(var a=0,i=Object.keys(e.parameters);a<i.length;a++){var s=i[a],o=e.parameters[s];if(void 0===o&&(e.parameters[s]="",o=""),"string"!==typeof o&&"number"!==typeof o)throw new TypeError("invalid codec parameter [key:".concat(s,"s, value:").concat(o,"]"));if("apt"===s&&"number"!==typeof o)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);var d,u=n(e.rtcpFeedback);try{for(u.s();!(d=u.n()).done;){c(d.value)}}catch(p){u.e(p)}finally{u.f()}}function p(e){if("object"!==typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!==typeof e.uri)throw new TypeError("missing ext.uri");if("number"!==typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!==typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"===typeof e.parameters||(e.parameters={});for(var t=0,r=Object.keys(e.parameters);t<r.length;t++){var n=r[t],a=e.parameters[n];if(void 0===a&&(e.parameters[n]="",a=""),"string"!==typeof a&&"number"!==typeof a)throw new TypeError("invalid header extension parameter")}}function l(e){if("object"!==typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!==typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!==typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!==typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!==typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"===typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!==typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function f(e){if("object"!==typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!==typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"===typeof e.reducedSize||(e.reducedSize=!0)}function h(e){if("object"!==typeof e)throw new TypeError("numStreams is not an object");if("number"!==typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!==typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function m(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function v(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.strict,i=void 0!==n&&n,s=r.modify,c=void 0!==s&&s,o=e.mimeType.toLowerCase(),d=t.mimeType.toLowerCase();if(o!==d)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(o){case"video/h264":var u=e.parameters["packetization-mode"]||0,p=t.parameters["packetization-mode"]||0;if(u!==p)return!1;if(i){if(!a.isSameProfile(e.parameters,t.parameters))return!1;var l;try{l=a.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(m){return!1}c&&(l?e.parameters["profile-level-id"]=l:delete e.parameters["profile-level-id"])}break;case"video/vp9":if(i){var f=e.parameters["profile-id"]||0,h=t.parameters["profile-id"]||0;if(f!==h)return!1}}return!0}function g(e,t){var r,a=[],i=n(e.rtcpFeedback||[]);try{var s=function(){var e=r.value,n=(t.rtcpFeedback||[]).find((function(t){return t.type===e.type&&(t.parameter===e.parameter||!t.parameter&&!e.parameter)}));n&&a.push(n)};for(i.s();!(r=i.n()).done;)s()}catch(c){i.e(c)}finally{i.f()}return a}t.validateRtpCapabilities=function(e){if("object"!==typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);var t,r=n(e.codecs);try{for(r.s();!(t=r.n()).done;){s(t.value)}}catch(c){r.e(c)}finally{r.f()}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);var a,i=n(e.headerExtensions);try{for(i.s();!(a=i.n()).done;){o(a.value)}}catch(c){i.e(c)}finally{i.f()}},t.validateRtpCodecCapability=s,t.validateRtcpFeedback=c,t.validateRtpHeaderExtension=o,t.validateRtpParameters=d,t.validateRtpCodecParameters=u,t.validateRtpHeaderExtensionParameters=p,t.validateRtpEncodingParameters=l,t.validateRtcpParameters=f,t.validateSctpCapabilities=function(e){if("object"!==typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!==typeof e.numStreams)throw new TypeError("missing caps.numStreams");h(e.numStreams)},t.validateNumSctpStreams=h,t.validateSctpParameters=function(e){if("object"!==typeof e)throw new TypeError("params is not an object");if("number"!==typeof e.port)throw new TypeError("missing params.port");if("number"!==typeof e.OS)throw new TypeError("missing params.OS");if("number"!==typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!==typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!==typeof e)throw new TypeError("params is not an object");if("number"!==typeof e.streamId)throw new TypeError("missing params.streamId");var t=!1;if("boolean"===typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!==typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!==typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.priority&&"string"!==typeof e.priority)throw new TypeError("invalid params.priority");if(e.label&&"string"!==typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!==typeof e.protocol)throw new TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){var r,a={codecs:[],headerExtensions:[]},i=n(t.codecs||[]);try{var s=function(){var t=r.value;if(m(t))return"continue";var n=(e.codecs||[]).find((function(e){return v(e,t,{strict:!0,modify:!0})}));if(!n)return"continue";var i={mimeType:n.mimeType,kind:n.kind,clockRate:n.clockRate,channels:n.channels,localPayloadType:n.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:t.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:n.parameters,remoteParameters:t.parameters,rtcpFeedback:g(n,t)};a.codecs.push(i)};for(i.s();!(r=i.n()).done;)s()}catch(f){i.e(f)}finally{i.f()}var c,o=n(a.codecs);try{var d=function(){var r=c.value,n=e.codecs.find((function(e){return m(e)&&e.parameters.apt===r.localPayloadType})),a=t.codecs.find((function(e){return m(e)&&e.parameters.apt===r.remotePayloadType}));n&&a&&(r.localRtxPayloadType=n.preferredPayloadType,r.remoteRtxPayloadType=a.preferredPayloadType)};for(o.s();!(c=o.n()).done;)d()}catch(f){o.e(f)}finally{o.f()}var u,p=n(t.headerExtensions);try{var l=function(){var t=u.value,r=e.headerExtensions.find((function(e){return n=t,(!(r=e).kind||!n.kind||r.kind===n.kind)&&r.uri===n.uri;var r,n}));if(!r)return"continue";var n={kind:t.kind,uri:t.uri,sendId:r.preferredId,recvId:t.preferredId,encrypt:r.preferredEncrypt,direction:"sendrecv"};switch(t.direction){case"sendrecv":n.direction="sendrecv";break;case"recvonly":n.direction="sendonly";break;case"sendonly":n.direction="recvonly";break;case"inactive":n.direction="inactive"}a.headerExtensions.push(n)};for(p.s();!(u=p.n()).done;)l()}catch(f){p.e(f)}finally{p.f()}return a},t.getRecvRtpCapabilities=function(e){var t,r={codecs:[],headerExtensions:[]},a=n(e.codecs);try{for(a.s();!(t=a.n()).done;){var i=t.value,s={mimeType:i.mimeType,kind:i.kind,preferredPayloadType:i.remotePayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.localParameters,rtcpFeedback:i.rtcpFeedback};if(r.codecs.push(s),i.remoteRtxPayloadType){var c={mimeType:"".concat(i.kind,"/rtx"),kind:i.kind,preferredPayloadType:i.remoteRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.remotePayloadType},rtcpFeedback:[]};r.codecs.push(c)}}}catch(l){a.e(l)}finally{a.f()}var o,d=n(e.headerExtensions);try{for(d.s();!(o=d.n()).done;){var u=o.value;if("sendrecv"===u.direction||"recvonly"===u.direction){var p={kind:u.kind,uri:u.uri,preferredId:u.recvId,preferredEncrypt:u.encrypt,direction:u.direction};r.headerExtensions.push(p)}}}catch(l){d.e(l)}finally{d.f()}return r},t.getSendingRtpParameters=function(e,t){var r,a={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},i=n(t.codecs);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(s.kind===e){var c={mimeType:s.mimeType,payloadType:s.localPayloadType,clockRate:s.clockRate,channels:s.channels,parameters:s.localParameters,rtcpFeedback:s.rtcpFeedback};if(a.codecs.push(c),s.localRtxPayloadType){var o={mimeType:"".concat(s.kind,"/rtx"),payloadType:s.localRtxPayloadType,clockRate:s.clockRate,parameters:{apt:s.localPayloadType},rtcpFeedback:[]};a.codecs.push(o)}}}}catch(f){i.e(f)}finally{i.f()}var d,u=n(t.headerExtensions);try{for(u.s();!(d=u.n()).done;){var p=d.value;if(!(p.kind&&p.kind!==e||"sendrecv"!==p.direction&&"sendonly"!==p.direction)){var l={uri:p.uri,id:p.sendId,encrypt:p.encrypt,parameters:{}};a.headerExtensions.push(l)}}}catch(f){u.e(f)}finally{u.f()}return a},t.getSendingRemoteRtpParameters=function(e,t){var r,a={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},i=n(t.codecs);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(s.kind===e){var c={mimeType:s.mimeType,payloadType:s.localPayloadType,clockRate:s.clockRate,channels:s.channels,parameters:s.remoteParameters,rtcpFeedback:s.rtcpFeedback};if(a.codecs.push(c),s.localRtxPayloadType){var o={mimeType:"".concat(s.kind,"/rtx"),payloadType:s.localRtxPayloadType,clockRate:s.clockRate,parameters:{apt:s.localPayloadType},rtcpFeedback:[]};a.codecs.push(o)}}}}catch(k){i.e(k)}finally{i.f()}var d,u=n(t.headerExtensions);try{for(u.s();!(d=u.n()).done;){var p=d.value;if(!(p.kind&&p.kind!==e||"sendrecv"!==p.direction&&"sendonly"!==p.direction)){var l={uri:p.uri,id:p.sendId,encrypt:p.encrypt,parameters:{}};a.headerExtensions.push(l)}}}catch(k){u.e(k)}finally{u.f()}if(a.headerExtensions.some((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri}))){var f,h=n(a.codecs);try{for(h.s();!(f=h.n()).done;){var m=f.value;m.rtcpFeedback=(m.rtcpFeedback||[]).filter((function(e){return"goog-remb"!==e.type}))}}catch(k){h.e(k)}finally{h.f()}}else if(a.headerExtensions.some((function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri}))){var v,g=n(a.codecs);try{for(g.s();!(v=g.n()).done;){var y=v.value;y.rtcpFeedback=(y.rtcpFeedback||[]).filter((function(e){return"transport-cc"!==e.type}))}}catch(k){g.e(k)}finally{g.f()}}else{var b,_=n(a.codecs);try{for(_.s();!(b=_.n()).done;){var w=b.value;w.rtcpFeedback=(w.rtcpFeedback||[]).filter((function(e){return"transport-cc"!==e.type&&"goog-remb"!==e.type}))}}catch(k){_.e(k)}finally{_.f()}}return a},t.reduceCodecs=function(e,t){var r=[];if(t){for(var n=0;n<e.length;++n)if(v(e[n],t)){r.push(e[n]),m(e[n+1])&&r.push(e[n+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),m(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e){d(e=i.clone(e,{}));var t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},t.canSend=function(e,t){return t.codecs.some((function(t){return t.kind===e}))},t.canReceive=function(e,t){if(d(e),0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some((function(e){return e.remotePayloadType===r.payloadType}))}},function(e,t,r){"use strict";var n=r(7),a=r(32),i=r(9),s=r(10),c=r(125);Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){i(r,e);var t=s(r);function r(e){var i;return n(this,r),(i=t.call(this,e)).name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(a(i),r):i.stack=new Error(e).stack,i}return r}(c(Error));t.UnsupportedError=o;var d=function(e){i(r,e);var t=s(r);function r(e){var i;return n(this,r),(i=t.call(this,e)).name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(a(i),r):i.stack=new Error(e).stack,i}return r}(c(Error));t.InvalidStateError=d},function(e,t,r){var n=r(131),a=r(132);t.write=a,t.parse=n.parse,t.parseParams=n.parseParams,t.parseFmtpConfig=n.parseFmtpConfig,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t,r){"use strict";var n=r(7),a=r(9),i=r(10);Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){a(r,e);var t=i(r);function r(){return n(this,r),t.call(this)}return r}(r(104).EnhancedEventEmitter);t.HandlerInterface=s},,function(e,t,r){"use strict";var n=r(50);Object.defineProperty(t,"__esModule",{value:!0});var a=r(99);t.extractRtpCapabilities=function(e){var t,r=e.sdpObject,i=new Map,s=[],c=!1,o=!1,d=n(r.media);try{for(d.s();!(t=d.n()).done;){var u=t.value,p=u.type;switch(p){case"audio":if(c)continue;c=!0;break;case"video":if(o)continue;o=!0;break;default:continue}var l,f=n(u.rtp);try{for(f.s();!(l=f.n()).done;){var h=l.value,m={kind:p,mimeType:"".concat(p,"/").concat(h.codec),preferredPayloadType:h.payload,clockRate:h.rate,channels:h.encoding,parameters:{},rtcpFeedback:[]};i.set(m.preferredPayloadType,m)}}catch(E){f.e(E)}finally{f.f()}var v,g=n(u.fmtp||[]);try{for(g.s();!(v=g.n()).done;){var y=v.value,b=a.parseParams(y.config),_=i.get(y.payload);_&&(b&&b["profile-level-id"]&&(b["profile-level-id"]=String(b["profile-level-id"])),_.parameters=b)}}catch(E){g.e(E)}finally{g.f()}var w,k=n(u.rtcpFb||[]);try{for(k.s();!(w=k.n()).done;){var S=w.value,x=i.get(S.payload);if(x){var R={type:S.type,parameter:S.subtype};R.parameter||delete R.parameter,x.rtcpFeedback.push(R)}}}catch(E){k.e(E)}finally{k.f()}var P,C=n(u.ext||[]);try{for(C.s();!(P=C.n()).done;){var T=P.value;if(!T["encrypt-uri"]){var D={kind:p,uri:T.uri,preferredId:T.value};s.push(D)}}}catch(E){C.e(E)}finally{C.f()}}}catch(E){d.e(E)}finally{d.f()}return{codecs:Array.from(i.values()),headerExtensions:s}},t.extractDtlsParameters=function(e){var t=e.sdpObject,r=(t.media||[]).find((function(e){return e.iceUfrag&&0!==e.port}));if(!r)throw new Error("no active media section found");var n,a=r.fingerprint||t.fingerprint;switch(r.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:a.type,value:a.hash}]}},t.getCname=function(e){var t=(e.offerMediaObject.ssrcs||[]).find((function(e){return"cname"===e.attribute}));return t?t.value:""},t.applyCodecParameters=function(e){var t,r=e.offerRtpParameters,i=e.answerMediaObject,s=n(r.codecs);try{var c=function(){var e=t.value,r=e.mimeType.toLowerCase();if("audio/opus"!==r)return"continue";if(!(i.rtp||[]).find((function(t){return t.payload===e.payloadType})))return"continue";i.fmtp=i.fmtp||[];var n=i.fmtp.find((function(t){return t.payload===e.payloadType}));n||(n={payload:e.payloadType,config:""},i.fmtp.push(n));var s=a.parseParams(n.config);switch(r){case"audio/opus":var c=e.parameters["sprop-stereo"];void 0!==c&&(s.stereo=c?1:0)}n.config="";for(var o=0,d=Object.keys(s);o<d.length;o++){var u=d[o];n.config&&(n.config+=";"),n.config+="".concat(u,"=").concat(s[u])}};for(s.s();!(t=s.n()).done;)c()}catch(o){s.e(o)}finally{s.f()}}},function(e,t,r){"use strict";var n=r(50),a=r(7),i=r(8);Object.defineProperty(t,"__esModule",{value:!0});var s=r(99),c=r(94),o=r(136),d=new c.Logger("RemoteSdp"),u=function(){function e(t){var r=t.iceParameters,n=t.iceCandidates,i=t.dtlsParameters,s=t.sctpParameters,c=t.plainRtpParameters,o=t.planB,d=void 0!==o&&o;if(a(this,e),this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=r,this._iceCandidates=n,this._dtlsParameters=i,this._sctpParameters=s,this._plainRtpParameters=c,this._planB=d,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},r&&r.iceLite&&(this._sdpObject.icelite="ice-lite"),i){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};var u=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:i.fingerprints[u-1].algorithm,hash:i.fingerprints[u-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}c&&(this._sdpObject.origin.address=c.ip,this._sdpObject.origin.ipVer=c.ipVersion)}return i(e,[{key:"updateIceParameters",value:function(e){d.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;var t,r=n(this._mediaSections);try{for(r.s();!(t=r.n()).done;){t.value.setIceParameters(e)}}catch(a){r.e(a)}finally{r.f()}}},{key:"updateDtlsRole",value:function(e){d.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;var t,r=n(this._mediaSections);try{for(r.s();!(t=r.n()).done;){t.value.setDtlsRole(e)}}catch(a){r.e(a)}finally{r.f()}}},{key:"getNextMediaSectionIdx",value:function(){for(var e=0;e<this._mediaSections.length;++e){var t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}},{key:"send",value:function(e){var t=e.offerMediaObject,r=e.reuseMid,n=e.offerRtpParameters,a=e.answerRtpParameters,i=e.codecOptions,s=e.extmapAllowMixed,c=void 0!==s&&s,d=new o.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:t,offerRtpParameters:n,answerRtpParameters:a,codecOptions:i,extmapAllowMixed:c});r?this._replaceMediaSection(d,r):this._midToIndex.has(d.mid)?this._replaceMediaSection(d):this._addMediaSection(d)}},{key:"receive",value:function(e){var t,r=e.mid,n=e.kind,a=e.offerRtpParameters,i=e.streamId,s=e.trackId,c=this._midToIndex.get(r);if(void 0!==c&&(t=this._mediaSections[c]),t)t.planBReceive({offerRtpParameters:a,streamId:i,trackId:s}),this._replaceMediaSection(t);else{t=new o.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:r,kind:n,offerRtpParameters:a,streamId:i,trackId:s});var d=this._mediaSections.find((function(e){return e.closed}));d?this._replaceMediaSection(t,d.mid):this._addMediaSection(t)}}},{key:"disableMediaSection",value:function(e){var t=this._midToIndex.get(e);if(void 0===t)throw new Error("no media section found with mid '".concat(e,"'"));this._mediaSections[t].disable()}},{key:"closeMediaSection",value:function(e){var t=this._midToIndex.get(e);if(void 0===t)throw new Error("no media section found with mid '".concat(e,"'"));var r=this._mediaSections[t];if(e===this._firstMid)return d.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),void this.disableMediaSection(e);r.close(),this._regenerateBundleMids()}},{key:"planBStopReceiving",value:function(e){var t=e.mid,r=e.offerRtpParameters,n=this._midToIndex.get(t);if(void 0===n)throw new Error("no media section found with mid '".concat(t,"'"));var a=this._mediaSections[n];a.planBStopReceiving({offerRtpParameters:r}),this._replaceMediaSection(a)}},{key:"sendSctpAssociation",value:function(e){var t=e.offerMediaObject,r=new o.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:t});this._addMediaSection(r)}},{key:"receiveSctpAssociation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.oldDataChannelSpec,r=void 0!==t&&t,n=new o.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:r});this._addMediaSection(n)}},{key:"getSdp",value:function(){return this._sdpObject.origin.sessionVersion++,s.write(this._sdpObject)}},{key:"_addMediaSection",value:function(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}},{key:"_replaceMediaSection",value:function(e,t){if("string"===typeof t){var r=this._midToIndex.get(t);if(void 0===r)throw new Error("no media section found for reuseMid '".concat(t,"'"));var n=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{var a=this._midToIndex.get(e.mid);if(void 0===a)throw new Error("no media section found with mid '".concat(e.mid,"'"));this._mediaSections[a]=e,this._sdpObject.media[a]=e.getObject()}}},{key:"_regenerateBundleMids",value:function(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((function(e){return!e.closed})).map((function(e){return e.mid})).join(" "))}}]),e}();t.RemoteSdp=u},function(e,t,r){"use strict";var n=r(93),a=r(95),i=r(7),s=r(8),c=r(9),o=r(10);Object.defineProperty(t,"__esModule",{value:!0});var d=r(124),u=new(r(94).Logger)("EnhancedEventEmitter"),p=function(e){c(r,e);var t=o(r);function r(){var e;return i(this,r),(e=t.call(this)).setMaxListeners(1/0),e}return s(r,[{key:"safeEmit",value:function(e){var t=this.listenerCount(e);try{for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return this.emit.apply(this,[e].concat(n))}catch(i){return u.error("safeEmit() | event listener threw an error [event:%s]:%o",e,i),Boolean(t)}}},{key:"safeEmitAsPromise",value:function(){var e=a(n.mark((function e(t){var r,a,i,s=this,c=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=c.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=c[i];return e.abrupt("return",new Promise((function(e,r){return s.safeEmit.apply(s,[t].concat(a,[e,r]))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),r}(d.EventEmitter);t.EnhancedEventEmitter=p},,function(e,t,r){"use strict";var n=r(120),a=r(50);Object.defineProperty(t,"__esModule",{value:!0}),t.getRtpEncodings=function(e){var t,r=e.offerMediaObject,i=new Set,s=a(r.ssrcs||[]);try{for(s.s();!(t=s.n()).done;){var c=t.value.id;i.add(c)}}catch(P){s.e(P)}finally{s.f()}if(0===i.size)throw new Error("no a=ssrc lines found");var o,d=new Map,u=a(r.ssrcGroups||[]);try{for(u.s();!(o=u.n()).done;){var p=o.value;if("FID"===p.semantics){var l=p.ssrcs.split(/\s+/),f=n(l,2),h=f[0],m=f[1];h=Number(h),m=Number(m),i.has(h)&&(i.delete(h),i.delete(m),d.set(h,m))}}}catch(P){u.e(P)}finally{u.f()}var v,g=a(i);try{for(g.s();!(v=g.n()).done;){var y=v.value;d.set(y,null)}}catch(P){g.e(P)}finally{g.f()}var b,_=[],w=a(d);try{for(w.s();!(b=w.n()).done;){var k=n(b.value,2),S=k[0],x=k[1],R={ssrc:S};x&&(R.rtx={ssrc:x}),_.push(R)}}catch(P){w.e(P)}finally{w.f()}return _},t.addLegacySimulcast=function(e){var t=e.offerMediaObject,r=e.numStreams;if(r<=1)throw new TypeError("numStreams must be greater than 1");var a=(t.ssrcs||[]).find((function(e){return"msid"===e.attribute}));if(!a)throw new Error("a=ssrc line with msid information not found");var i,s=n(a.value.split(" ")[0],2),c=s[0],o=s[1],d=a.id;(t.ssrcGroups||[]).some((function(e){if("FID"!==e.semantics)return!1;var t=e.ssrcs.split(/\s+/);return Number(t[0])===d&&(i=Number(t[1]),!0)}));var u=t.ssrcs.find((function(e){return"cname"===e.attribute}));if(!u)throw new Error("a=ssrc line with cname information not found");for(var p=u.value,l=[],f=[],h=0;h<r;++h)l.push(d+h),i&&f.push(i+h);t.ssrcGroups=[],t.ssrcs=[],t.ssrcGroups.push({semantics:"SIM",ssrcs:l.join(" ")});for(var m=0;m<l.length;++m){var v=l[m];t.ssrcs.push({id:v,attribute:"cname",value:p}),t.ssrcs.push({id:v,attribute:"msid",value:"".concat(c," ").concat(o)})}for(var g=0;g<f.length;++g){var y=l[g],b=f[g];t.ssrcs.push({id:b,attribute:"cname",value:p}),t.ssrcs.push({id:b,attribute:"msid",value:"".concat(c," ").concat(o)}),t.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(y," ").concat(b)})}}},function(e,t,r){"use strict";var n=r(120),a=r(50);Object.defineProperty(t,"__esModule",{value:!0}),t.getRtpEncodings=function(e){var t,r,i=e.offerMediaObject,s=e.track,c=new Set,o=a(i.ssrcs||[]);try{for(o.s();!(r=o.n()).done;){var d=r.value;if("msid"===d.attribute)if(d.value.split(" ")[1]===s.id){var u=d.id;c.add(u),t||(t=u)}}}catch(D){o.e(D)}finally{o.f()}if(0===c.size)throw new Error("a=ssrc line with msid information not found [track.id:".concat(s.id,"]"));var p,l=new Map,f=a(i.ssrcGroups||[]);try{for(f.s();!(p=f.n()).done;){var h=p.value;if("FID"===h.semantics){var m=h.ssrcs.split(/\s+/),v=n(m,2),g=v[0],y=v[1];g=Number(g),y=Number(y),c.has(g)&&(c.delete(g),c.delete(y),l.set(g,y))}}}catch(D){f.e(D)}finally{f.f()}var b,_=a(c);try{for(_.s();!(b=_.n()).done;){var w=b.value;l.set(w,null)}}catch(D){_.e(D)}finally{_.f()}var k,S=[],x=a(l);try{for(x.s();!(k=x.n()).done;){var R=n(k.value,2),P=R[0],C=R[1],T={ssrc:P};C&&(T.rtx={ssrc:C}),S.push(T)}}catch(D){x.e(D)}finally{x.f()}return S},t.addLegacySimulcast=function(e){var t,r,n,a=e.offerMediaObject,i=e.track,s=e.numStreams;if(s<=1)throw new TypeError("numStreams must be greater than 1");if(!(a.ssrcs||[]).find((function(e){return"msid"===e.attribute&&(e.value.split(" ")[1]===i.id&&(t=e.id,n=e.value.split(" ")[0],!0))})))throw new Error("a=ssrc line with msid information not found [track.id:".concat(i.id,"]"));(a.ssrcGroups||[]).some((function(e){if("FID"!==e.semantics)return!1;var n=e.ssrcs.split(/\s+/);return Number(n[0])===t&&(r=Number(n[1]),!0)}));var c=a.ssrcs.find((function(e){return"cname"===e.attribute&&e.id===t}));if(!c)throw new Error("a=ssrc line with cname information not found [track.id:".concat(i.id,"]"));for(var o=c.value,d=[],u=[],p=0;p<s;++p)d.push(t+p),r&&u.push(r+p);a.ssrcGroups=a.ssrcGroups||[],a.ssrcs=a.ssrcs||[],a.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(var l=0;l<d.length;++l){var f=d[l];a.ssrcs.push({id:f,attribute:"cname",value:o}),a.ssrcs.push({id:f,attribute:"msid",value:"".concat(n," ").concat(i.id)})}for(var h=0;h<u.length;++h){var m=d[h],v=u[h];a.ssrcs.push({id:v,attribute:"cname",value:o}),a.ssrcs.push({id:v,attribute:"msid",value:"".concat(n," ").concat(i.id)}),a.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(m," ").concat(v)})}}},function(e,t,r){"use strict";function n(e,t,r,n,a,i,s){try{var c=e[i](s),o=c.value}catch(d){return void r(d)}c.done?t(o):Promise.resolve(o).then(n,a)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var s=e.apply(t,r);function c(e){n(s,a,i,c,o,"next",e)}function o(e){n(s,a,i,c,o,"throw",e)}c(void 0)}))}}r.d(t,"a",(function(){return a}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(112);t.Device=n.Device,t.detectDevice=n.detectDevice;var a=r(146);t.types=a,t.version="3.6.21";var i=r(110);t.parseScalabilityMode=i.parse},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){var t=n.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,i=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(o){a=!0,i=o}finally{try{n||null==c.return||c.return()}finally{if(a)throw i}}return r}}(e,t)||function(e,t){if(e){if("string"===typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.d(t,"a",(function(){return a}))},function(e,t,r){"use strict";var n=r(93),a=r(95),i=r(7),s=r(8);Object.defineProperty(t,"__esModule",{value:!0});var c=r(122),o=r(94),d=r(104),u=r(98),p=r(96),l=r(97),f=r(114),h=r(130),m=r(137),v=r(138),g=r(139),y=r(140),b=r(141),_=r(142),w=r(143),k=r(145),S=new o.Logger("Device");function x(){if("object"===typeof navigator&&"ReactNative"===navigator.product)return"undefined"===typeof RTCPeerConnection?void S.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(S.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative");if("object"!==typeof navigator||"string"!==typeof navigator.userAgent)S.warn("this._detectDevice() | unknown device");else{var e=navigator.userAgent,t=c.getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({safari:">=12.0"})&&"undefined"!==typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){var n=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(n){var a=Number(n[1]);return a>=74?"Chrome74":a>=70?"Chrome70":a>=67?"Chrome67":"Chrome55"}return"Chrome74"}S.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion())}}t.detectDevice=x;var R=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.handlerName,n=t.handlerFactory,a=t.Handler;if(i(this,e),this._loaded=!1,this._observer=new d.EnhancedEventEmitter,S.debug("constructor()"),a){if(S.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!==typeof a)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");r=a}if(r&&n)throw new TypeError("just one of handlerName or handlerInterface can be given");if(n)this._handlerFactory=n;else{if(r)S.debug("constructor() | handler given: %s",r);else{if(!(r=x()))throw new u.UnsupportedError("device not supported");S.debug("constructor() | detected handler: %s",r)}switch(r){case"Chrome74":this._handlerFactory=h.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=m.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=v.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=g.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=y.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=b.Safari12.createFactory();break;case"Safari11":this._handlerFactory=_.Safari11.createFactory();break;case"Edge11":this._handlerFactory=w.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=k.ReactNative.createFactory();break;default:throw new TypeError('unknown handlerName "'.concat(r,'"'))}}var s=this._handlerFactory();this._handlerName=s.name,s.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}return s(e,[{key:"load",value:function(){var e=a(n.mark((function e(t){var r,a,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.routerRtpCapabilities,S.debug("load() [routerRtpCapabilities:%o]",r),r=p.clone(r,void 0),e.prev=3,!this._loaded){e.next=6;break}throw new u.InvalidStateError("already loaded");case 6:return l.validateRtpCapabilities(r),a=this._handlerFactory(),e.next=10,a.getNativeRtpCapabilities();case 10:return i=e.sent,S.debug("load() | got native RTP capabilities:%o",i),l.validateRtpCapabilities(i),this._extendedRtpCapabilities=l.getExtendedRtpCapabilities(i,r),S.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=l.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=l.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=l.getRecvRtpCapabilities(this._extendedRtpCapabilities),l.validateRtpCapabilities(this._recvRtpCapabilities),S.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),e.next=22,a.getNativeSctpCapabilities();case 22:this._sctpCapabilities=e.sent,S.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),l.validateSctpCapabilities(this._sctpCapabilities),S.debug("load() succeeded"),this._loaded=!0,a.close(),e.next=34;break;case 30:throw e.prev=30,e.t0=e.catch(3),a&&a.close(),e.t0;case 34:case"end":return e.stop()}}),e,this,[[3,30]])})));return function(t){return e.apply(this,arguments)}}()},{key:"canProduce",value:function(e){if(!this._loaded)throw new u.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'.concat(e,'"'));return this._canProduceByKind[e]}},{key:"createSendTransport",value:function(e){var t=e.id,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,i=e.sctpParameters,s=e.iceServers,c=e.iceTransportPolicy,o=e.additionalSettings,d=e.proprietaryConstraints,u=e.appData,p=void 0===u?{}:u;return S.debug("createSendTransport()"),this._createTransport({direction:"send",id:t,iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:i,iceServers:s,iceTransportPolicy:c,additionalSettings:o,proprietaryConstraints:d,appData:p})}},{key:"createRecvTransport",value:function(e){var t=e.id,r=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,i=e.sctpParameters,s=e.iceServers,c=e.iceTransportPolicy,o=e.additionalSettings,d=e.proprietaryConstraints,u=e.appData,p=void 0===u?{}:u;return S.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:t,iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:i,iceServers:s,iceTransportPolicy:c,additionalSettings:o,proprietaryConstraints:d,appData:p})}},{key:"_createTransport",value:function(e){var t=e.direction,r=e.id,n=e.iceParameters,a=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,o=e.iceTransportPolicy,d=e.additionalSettings,p=e.proprietaryConstraints,l=e.appData,h=void 0===l?{}:l;if(!this._loaded)throw new u.InvalidStateError("not loaded");if("string"!==typeof r)throw new TypeError("missing id");if("object"!==typeof n)throw new TypeError("missing iceParameters");if(!Array.isArray(a))throw new TypeError("missing iceCandidates");if("object"!==typeof i)throw new TypeError("missing dtlsParameters");if(s&&"object"!==typeof s)throw new TypeError("wrong sctpParameters");if(h&&"object"!==typeof h)throw new TypeError("if given, appData must be an object");var m=new f.Transport({direction:t,id:r,iceParameters:n,iceCandidates:a,dtlsParameters:i,sctpParameters:s,iceServers:c,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,appData:h,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",m),m}},{key:"handlerName",get:function(){return this._handlerName}},{key:"loaded",get:function(){return this._loaded}},{key:"rtpCapabilities",get:function(){if(!this._loaded)throw new u.InvalidStateError("not loaded");return this._recvRtpCapabilities}},{key:"sctpCapabilities",get:function(){if(!this._loaded)throw new u.InvalidStateError("not loaded");return this._sctpCapabilities}},{key:"observer",get:function(){return this._observer}}]),e}();t.Device=R},function(e,t,r){(function(n){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,a=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(a=n))})),t.splice(a,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(r){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(r){}!e&&"undefined"!==typeof n&&"env"in n&&(e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).DEBUG);return e},t.useColors=function(){if("undefined"!==typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=r(123)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this,r(20))},function(e,t,r){"use strict";var n=r(93),a=r(95),i=r(50),s=r(7),c=r(8),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(129),p=r(94),l=r(104),f=r(98),h=r(96),m=r(97),v=r(115),g=r(116),y=r(117),b=r(118),_=new p.Logger("Transport"),w=function(e){o(r,e);var t=d(r);function r(e){var n,a=e.direction,i=e.id,c=e.iceParameters,o=e.iceCandidates,d=e.dtlsParameters,p=e.sctpParameters,m=e.iceServers,v=e.iceTransportPolicy,g=e.additionalSettings,y=e.proprietaryConstraints,b=e.appData,w=e.handlerFactory,k=e.extendedRtpCapabilities,S=e.canProduceByKind;return s(this,r),(n=t.call(this))._closed=!1,n._connectionState="new",n._producers=new Map,n._consumers=new Map,n._dataProducers=new Map,n._dataConsumers=new Map,n._probatorConsumerCreated=!1,n._awaitQueue=new u.AwaitQueue({ClosedErrorClass:f.InvalidStateError}),n._observer=new l.EnhancedEventEmitter,_.debug("constructor() [id:%s, direction:%s]",i,a),n._id=i,n._direction=a,n._extendedRtpCapabilities=k,n._canProduceByKind=S,n._maxSctpMessageSize=p?p.maxMessageSize:null,delete(g=h.clone(g,{})).iceServers,delete g.iceTransportPolicy,delete g.bundlePolicy,delete g.rtcpMuxPolicy,delete g.sdpSemantics,n._handler=w(),n._handler.run({direction:a,iceParameters:c,iceCandidates:o,dtlsParameters:d,sctpParameters:p,iceServers:m,iceTransportPolicy:v,additionalSettings:g,proprietaryConstraints:y,extendedRtpCapabilities:k}),n._appData=b,n._handleHandler(),n}return c(r,[{key:"close",value:function(){if(!this._closed){_.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();var e,t=i(this._producers.values());try{for(t.s();!(e=t.n()).done;){e.value.transportClosed()}}catch(d){t.e(d)}finally{t.f()}this._producers.clear();var r,n=i(this._consumers.values());try{for(n.s();!(r=n.n()).done;){r.value.transportClosed()}}catch(d){n.e(d)}finally{n.f()}this._consumers.clear();var a,s=i(this._dataProducers.values());try{for(s.s();!(a=s.n()).done;){a.value.transportClosed()}}catch(d){s.e(d)}finally{s.f()}this._dataProducers.clear();var c,o=i(this._dataConsumers.values());try{for(o.s();!(c=o.n()).done;){c.value.transportClosed()}}catch(d){o.e(d)}finally{o.f()}this._dataConsumers.clear(),this._observer.safeEmit("close")}}},{key:"getStats",value:function(){var e=a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new f.InvalidStateError("closed");case 2:return e.abrupt("return",this._handler.getTransportStats());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=a(n.mark((function e(t){var r,i=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.iceParameters,_.debug("restartIce()"),!this._closed){e.next=6;break}throw new f.InvalidStateError("closed");case 6:if(r){e.next=8;break}throw new TypeError("missing iceParameters");case 8:return e.abrupt("return",this._awaitQueue.push(a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i._handler.restartIce(r));case 1:case"end":return e.stop()}}),e)}))),"transport.restartIce()"));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateIceServers",value:function(){var e=a(n.mark((function e(){var t,r,i=this,s=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},r=t.iceServers,_.debug("updateIceServers()"),!this._closed){e.next=6;break}throw new f.InvalidStateError("closed");case 6:if(Array.isArray(r)){e.next=8;break}throw new TypeError("missing iceServers");case 8:return e.abrupt("return",this._awaitQueue.push(a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i._handler.updateIceServers(r));case 1:case"end":return e.stop()}}),e)}))),"transport.updateIceServers()"));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"produce",value:function(){var e=a(n.mark((function e(){var t,r,i,s,c,o,d,u,p,l,h,g,y,b=this,w=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=w.length>0&&void 0!==w[0]?w[0]:{},r=t.track,i=t.encodings,s=t.codecOptions,c=t.codec,o=t.stopTracks,d=void 0===o||o,u=t.disableTrackOnPause,p=void 0===u||u,l=t.zeroRtpOnPause,h=void 0!==l&&l,g=t.appData,y=void 0===g?{}:g,_.debug("produce() [track:%o]",r),r){e.next=6;break}throw new TypeError("missing track");case 6:if("send"===this._direction){e.next=10;break}throw new f.UnsupportedError("not a sending Transport");case 10:if(this._canProduceByKind[r.kind]){e.next=14;break}throw new f.UnsupportedError("cannot produce ".concat(r.kind));case 14:if("ended"!==r.readyState){e.next=18;break}throw new f.InvalidStateError("track ended");case 18:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=22;break}throw new TypeError('no "connect" listener set into this transport');case 22:if(0!==this.listenerCount("produce")){e.next=26;break}throw new TypeError('no "produce" listener set into this transport');case 26:if(!y||"object"===typeof y){e.next=28;break}throw new TypeError("if given, appData must be an object");case 28:return e.abrupt("return",this._awaitQueue.push(a(n.mark((function e(){var t,a,o,u,l,f,g,_;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||Array.isArray(i)){e.next=4;break}throw TypeError("encodings must be an array");case 4:i&&0===i.length?t=void 0:i&&(t=i.map((function(e){var t={active:!0};return!1===e.active&&(t.active=!1),"boolean"===typeof e.dtx&&(t.dtx=e.dtx),"string"===typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"===typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"===typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"===typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"===typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"===typeof e.priority&&(t.priority=e.priority),"string"===typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));case 5:return e.next=7,b._handler.send({track:r,encodings:t,codecOptions:s,codec:c});case 7:return a=e.sent,o=a.localId,u=a.rtpParameters,l=a.rtpSender,e.prev=11,m.validateRtpParameters(u),e.next=15,b.safeEmitAsPromise("produce",{kind:r.kind,rtpParameters:u,appData:y});case 15:return f=e.sent,g=f.id,_=new v.Producer({id:g,localId:o,rtpSender:l,track:r,rtpParameters:u,stopTracks:d,disableTrackOnPause:p,zeroRtpOnPause:h,appData:y}),b._producers.set(_.id,_),b._handleProducer(_),b._observer.safeEmit("newproducer",_),e.abrupt("return",_);case 24:throw e.prev=24,e.t0=e.catch(11),b._handler.stopSending(o).catch((function(){})),e.t0;case 28:case"end":return e.stop()}}),e,null,[[11,24]])}))),"transport.produce()").catch((function(e){if(d)try{r.stop()}catch(t){}throw e})));case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"consume",value:function(){var e=a(n.mark((function e(t){var r,i,s,c,o,d,u=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,i=t.producerId,s=t.kind,c=t.rtpParameters,o=t.appData,d=void 0===o?{}:o,_.debug("consume()"),c=h.clone(c,void 0),!this._closed){e.next=7;break}throw new f.InvalidStateError("closed");case 7:if("recv"===this._direction){e.next=11;break}throw new f.UnsupportedError("not a receiving Transport");case 11:if("string"===typeof r){e.next=15;break}throw new TypeError("missing id");case 15:if("string"===typeof i){e.next=19;break}throw new TypeError("missing producerId");case 19:if("audio"===s||"video"===s){e.next=23;break}throw new TypeError("invalid kind '".concat(s,"'"));case 23:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=27;break}throw new TypeError('no "connect" listener set into this transport');case 27:if(!d||"object"===typeof d){e.next=29;break}throw new TypeError("if given, appData must be an object");case 29:return e.abrupt("return",this._awaitQueue.push(a(n.mark((function e(){var t,a,o,p,l,h;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m.canReceive(c,u._extendedRtpCapabilities)){e.next=3;break}throw new f.UnsupportedError("cannot consume this Producer");case 3:return e.next=5,u._handler.receive({trackId:r,kind:s,rtpParameters:c});case 5:if(t=e.sent,a=t.localId,o=t.rtpReceiver,p=t.track,l=new g.Consumer({id:r,localId:a,producerId:i,rtpReceiver:o,track:p,rtpParameters:c,appData:d}),u._consumers.set(l.id,l),u._handleConsumer(l),u._probatorConsumerCreated||"video"!==s){e.next=24;break}return e.prev=13,h=m.generateProbatorRtpParameters(l.rtpParameters),e.next=17,u._handler.receive({trackId:"probator",kind:"video",rtpParameters:h});case 17:_.debug("consume() | Consumer for RTP probation created"),u._probatorConsumerCreated=!0,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(13),_.error("consume() | failed to create Consumer for RTP probation:%o",e.t0);case 24:return u._observer.safeEmit("newconsumer",l),e.abrupt("return",l);case 26:case"end":return e.stop()}}),e,null,[[13,21]])}))),"transport.consume()"));case 30:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"produceData",value:function(){var e=a(n.mark((function e(){var t,r,i,s,c,o,d,u,p,l,h,v,g,b=this,w=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=w.length>0&&void 0!==w[0]?w[0]:{},r=t.ordered,i=void 0===r||r,s=t.maxPacketLifeTime,c=t.maxRetransmits,o=t.priority,d=void 0===o?"low":o,u=t.label,p=void 0===u?"":u,l=t.protocol,h=void 0===l?"":l,v=t.appData,g=void 0===v?{}:v,_.debug("produceData()"),"send"===this._direction){e.next=6;break}throw new f.UnsupportedError("not a sending Transport");case 6:if(this._maxSctpMessageSize){e.next=10;break}throw new f.UnsupportedError("SCTP not enabled by remote Transport");case 10:if(["very-low","low","medium","high"].includes(d)){e.next=14;break}throw new TypeError("wrong priority");case 14:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=18;break}throw new TypeError('no "connect" listener set into this transport');case 18:if(0!==this.listenerCount("producedata")){e.next=22;break}throw new TypeError('no "producedata" listener set into this transport');case 22:if(!g||"object"===typeof g){e.next=24;break}throw new TypeError("if given, appData must be an object");case 24:return(s||c)&&(i=!1),e.abrupt("return",this._awaitQueue.push(a(n.mark((function e(){var t,r,a,o,u,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b._handler.sendDataChannel({ordered:i,maxPacketLifeTime:s,maxRetransmits:c,priority:d,label:p,protocol:h});case 2:return t=e.sent,r=t.dataChannel,a=t.sctpStreamParameters,m.validateSctpStreamParameters(a),e.next=8,b.safeEmitAsPromise("producedata",{sctpStreamParameters:a,label:p,protocol:h,appData:g});case 8:return o=e.sent,u=o.id,l=new y.DataProducer({id:u,dataChannel:r,sctpStreamParameters:a,appData:g}),b._dataProducers.set(l.id,l),b._handleDataProducer(l),b._observer.safeEmit("newdataproducer",l),e.abrupt("return",l);case 15:case"end":return e.stop()}}),e)}))),"transport.produceData()"));case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"consumeData",value:function(){var e=a(n.mark((function e(t){var r,i,s,c,o,d,u,p,l,v=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,i=t.dataProducerId,s=t.sctpStreamParameters,c=t.label,o=void 0===c?"":c,d=t.protocol,u=void 0===d?"":d,p=t.appData,l=void 0===p?{}:p,_.debug("consumeData()"),s=h.clone(s,void 0),!this._closed){e.next=7;break}throw new f.InvalidStateError("closed");case 7:if("recv"===this._direction){e.next=11;break}throw new f.UnsupportedError("not a receiving Transport");case 11:if(this._maxSctpMessageSize){e.next=15;break}throw new f.UnsupportedError("SCTP not enabled by remote Transport");case 15:if("string"===typeof r){e.next=19;break}throw new TypeError("missing id");case 19:if("string"===typeof i){e.next=23;break}throw new TypeError("missing dataProducerId");case 23:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=27;break}throw new TypeError('no "connect" listener set into this transport');case 27:if(!l||"object"===typeof l){e.next=29;break}throw new TypeError("if given, appData must be an object");case 29:return m.validateSctpStreamParameters(s),e.abrupt("return",this._awaitQueue.push(a(n.mark((function e(){var t,a,c;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v._handler.receiveDataChannel({sctpStreamParameters:s,label:o,protocol:u});case 2:return t=e.sent,a=t.dataChannel,c=new b.DataConsumer({id:r,dataProducerId:i,dataChannel:a,sctpStreamParameters:s,appData:l}),v._dataConsumers.set(c.id,c),v._handleDataConsumer(c),v._observer.safeEmit("newdataconsumer",c),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)}))),"transport.consumeData()"));case 31:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleHandler",value:function(){var e=this,t=this._handler;t.on("@connect",(function(t,r,n){var a=t.dtlsParameters;e._closed?n(new f.InvalidStateError("closed")):e.safeEmit("connect",{dtlsParameters:a},r,n)})),t.on("@connectionstatechange",(function(t){t!==e._connectionState&&(_.debug("connection state changed to %s",t),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))}))}},{key:"_handleProducer",value:function(e){var t=this;e.on("@close",(function(){t._producers.delete(e.id),t._closed||t._awaitQueue.push(a(n.mark((function r(){return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._handler.stopSending(e.localId));case 1:case"end":return r.stop()}}),r)}))),"producer @close event").catch((function(e){return _.warn("producer.close() failed:%o",e)}))})),e.on("@replacetrack",(function(r,i,s){t._awaitQueue.push(a(n.mark((function a(){return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.replaceTrack(e.localId,r));case 1:case"end":return n.stop()}}),a)}))),"producer @replacetrack event").then(i).catch(s)})),e.on("@setmaxspatiallayer",(function(r,i,s){t._awaitQueue.push(a(n.mark((function a(){return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.setMaxSpatialLayer(e.localId,r));case 1:case"end":return n.stop()}}),a)}))),"producer @setmaxspatiallayer event").then(i).catch(s)})),e.on("@setrtpencodingparameters",(function(r,i,s){t._awaitQueue.push(a(n.mark((function a(){return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.setRtpEncodingParameters(e.localId,r));case 1:case"end":return n.stop()}}),a)}))),"producer @setrtpencodingparameters event").then(i).catch(s)})),e.on("@getstats",(function(r,n){if(t._closed)return n(new f.InvalidStateError("closed"));t._handler.getSenderStats(e.localId).then(r).catch(n)}))}},{key:"_handleConsumer",value:function(e){var t=this;e.on("@close",(function(){t._consumers.delete(e.id),t._closed||t._awaitQueue.push(a(n.mark((function r(){return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._handler.stopReceiving(e.localId));case 1:case"end":return r.stop()}}),r)}))),"consumer @close event").catch((function(){}))})),e.on("@getstats",(function(r,n){if(t._closed)return n(new f.InvalidStateError("closed"));t._handler.getReceiverStats(e.localId).then(r).catch(n)}))}},{key:"_handleDataProducer",value:function(e){var t=this;e.on("@close",(function(){t._dataProducers.delete(e.id)}))}},{key:"_handleDataConsumer",value:function(e){var t=this;e.on("@close",(function(){t._dataConsumers.delete(e.id)}))}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"handler",get:function(){return this._handler}},{key:"connectionState",get:function(){return this._connectionState}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}},{key:"observer",get:function(){return this._observer}}]),r}(l.EnhancedEventEmitter);t.Transport=w},function(e,t,r){"use strict";var n=r(93),a=r(95),i=r(7),s=r(8),c=r(32),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(94),p=r(104),l=r(98),f=new u.Logger("Producer"),h=function(e){o(r,e);var t=d(r);function r(e){var n,a=e.id,s=e.localId,o=e.rtpSender,d=e.track,u=e.rtpParameters,l=e.stopTracks,h=e.disableTrackOnPause,m=e.zeroRtpOnPause,v=e.appData;return i(this,r),(n=t.call(this))._closed=!1,n._observer=new p.EnhancedEventEmitter,f.debug("constructor()"),n._id=a,n._localId=s,n._rtpSender=o,n._track=d,n._kind=d.kind,n._rtpParameters=u,n._paused=!!h&&!d.enabled,n._maxSpatialLayer=void 0,n._stopTracks=l,n._disableTrackOnPause=h,n._zeroRtpOnPause=m,n._appData=v,n._onTrackEnded=n._onTrackEnded.bind(c(n)),n._handleTrack(),n}return s(r,[{key:"close",value:function(){this._closed||(f.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(f.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"getStats",value:function(){var e=a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new l.InvalidStateError("closed");case 2:return e.abrupt("return",this.safeEmitAsPromise("@getstats"));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pause",value:function(){f.debug("pause()"),this._closed?f.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch((function(){})),this._observer.safeEmit("pause"))}},{key:"resume",value:function(){f.debug("resume()"),this._closed?f.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch((function(){})),this._observer.safeEmit("resume"))}},{key:"replaceTrack",value:function(){var e=a(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,f.debug("replaceTrack() [track:%o]",r),!this._closed){e.next=7;break}if(r&&this._stopTracks)try{r.stop()}catch(n){}throw new l.InvalidStateError("closed");case 7:if(!r||"ended"!==r.readyState){e.next=9;break}throw new l.InvalidStateError("track ended");case 9:if(r!==this._track){e.next=12;break}return f.debug("replaceTrack() | same track, ignored"),e.abrupt("return");case 12:if(this._zeroRtpOnPause&&this._paused){e.next=15;break}return e.next=15,this.safeEmitAsPromise("@replacetrack",r);case 15:this._destroyTrack(),this._track=r,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack();case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=a(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=4;break}throw new l.InvalidStateError("closed");case 4:if("video"===this._kind){e.next=8;break}throw new l.UnsupportedError("not a video Producer");case 8:if("number"===typeof t){e.next=10;break}throw new TypeError("invalid spatialLayer");case 10:if(t!==this._maxSpatialLayer){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,this.safeEmitAsPromise("@setmaxspatiallayer",t);case 14:this._maxSpatialLayer=t;case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=a(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=4;break}throw new l.InvalidStateError("closed");case 4:if("object"===typeof t){e.next=6;break}throw new TypeError("invalid params");case 6:return e.next=8,this.safeEmitAsPromise("@setrtpencodingparameters",t);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_onTrackEnded",value:function(){f.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}},{key:"_handleTrack",value:function(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}},{key:"_destroyTrack",value:function(){if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}},{key:"id",get:function(){return this._id}},{key:"localId",get:function(){return this._localId}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpSender",get:function(){return this._rtpSender}},{key:"track",get:function(){return this._track}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"paused",get:function(){return this._paused}},{key:"maxSpatialLayer",get:function(){return this._maxSpatialLayer}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}},{key:"observer",get:function(){return this._observer}}]),r}(p.EnhancedEventEmitter);t.Producer=h},function(e,t,r){"use strict";var n=r(93),a=r(95),i=r(7),s=r(8),c=r(32),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(94),p=r(104),l=r(98),f=new u.Logger("Consumer"),h=function(e){o(r,e);var t=d(r);function r(e){var n,a=e.id,s=e.localId,o=e.producerId,d=e.rtpReceiver,u=e.track,l=e.rtpParameters,h=e.appData;return i(this,r),(n=t.call(this))._closed=!1,n._observer=new p.EnhancedEventEmitter,f.debug("constructor()"),n._id=a,n._localId=s,n._producerId=o,n._rtpReceiver=d,n._track=u,n._rtpParameters=l,n._paused=!u.enabled,n._appData=h,n._onTrackEnded=n._onTrackEnded.bind(c(n)),n._handleTrack(),n}return s(r,[{key:"close",value:function(){this._closed||(f.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(f.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"getStats",value:function(){var e=a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new l.InvalidStateError("closed");case 2:return e.abrupt("return",this.safeEmitAsPromise("@getstats"));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pause",value:function(){f.debug("pause()"),this._closed?f.error("pause() | Consumer closed"):(this._paused=!0,this._track.enabled=!1,this._observer.safeEmit("pause"))}},{key:"resume",value:function(){f.debug("resume()"),this._closed?f.error("resume() | Consumer closed"):(this._paused=!1,this._track.enabled=!0,this._observer.safeEmit("resume"))}},{key:"_onTrackEnded",value:function(){f.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}},{key:"_handleTrack",value:function(){this._track.addEventListener("ended",this._onTrackEnded)}},{key:"_destroyTrack",value:function(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}},{key:"id",get:function(){return this._id}},{key:"localId",get:function(){return this._localId}},{key:"producerId",get:function(){return this._producerId}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"rtpReceiver",get:function(){return this._rtpReceiver}},{key:"track",get:function(){return this._track}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"paused",get:function(){return this._paused}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}},{key:"observer",get:function(){return this._observer}}]),r}(p.EnhancedEventEmitter);t.Consumer=h},function(e,t,r){"use strict";var n=r(7),a=r(8),i=r(9),s=r(10);Object.defineProperty(t,"__esModule",{value:!0});var c=r(94),o=r(104),d=r(98),u=new c.Logger("DataProducer"),p=function(e){i(r,e);var t=s(r);function r(e){var a,i=e.id,s=e.dataChannel,c=e.sctpStreamParameters,d=e.appData;return n(this,r),(a=t.call(this))._closed=!1,a._observer=new o.EnhancedEventEmitter,u.debug("constructor()"),a._id=i,a._dataChannel=s,a._sctpStreamParameters=c,a._appData=d,a._handleDataChannel(),a}return a(r,[{key:"close",value:function(){this._closed||(u.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(u.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"send",value:function(e){if(u.debug("send()"),this._closed)throw new d.InvalidStateError("closed");this._dataChannel.send(e)}},{key:"_handleDataChannel",value:function(){var e=this;this._dataChannel.addEventListener("open",(function(){e._closed||(u.debug('DataChannel "open" event'),e.safeEmit("open"))})),this._dataChannel.addEventListener("error",(function(t){if(!e._closed){var r=t.error;r||(r=new Error("unknown DataChannel error")),"sctp-failure"===r.errorDetail?u.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",r.sctpCauseCode,r.message):u.error('DataChannel "error" event: %o',r),e.safeEmit("error",r)}})),this._dataChannel.addEventListener("close",(function(){e._closed||(u.warn('DataChannel "close" event'),e._closed=!0,e.emit("@close"),e.safeEmit("close"))})),this._dataChannel.addEventListener("message",(function(){e._closed||u.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(function(){e._closed||e.safeEmit("bufferedamountlow")}))}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"sctpStreamParameters",get:function(){return this._sctpStreamParameters}},{key:"readyState",get:function(){return this._dataChannel.readyState}},{key:"label",get:function(){return this._dataChannel.label}},{key:"protocol",get:function(){return this._dataChannel.protocol}},{key:"bufferedAmount",get:function(){return this._dataChannel.bufferedAmount}},{key:"bufferedAmountLowThreshold",get:function(){return this._dataChannel.bufferedAmountLowThreshold},set:function(e){this._dataChannel.bufferedAmountLowThreshold=e}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}},{key:"observer",get:function(){return this._observer}}]),r}(o.EnhancedEventEmitter);t.DataProducer=p},function(e,t,r){"use strict";var n=r(7),a=r(8),i=r(9),s=r(10);Object.defineProperty(t,"__esModule",{value:!0});var c=r(94),o=r(104),d=new c.Logger("DataConsumer"),u=function(e){i(r,e);var t=s(r);function r(e){var a,i=e.id,s=e.dataProducerId,c=e.dataChannel,u=e.sctpStreamParameters,p=e.appData;return n(this,r),(a=t.call(this))._closed=!1,a._observer=new o.EnhancedEventEmitter,d.debug("constructor()"),a._id=i,a._dataProducerId=s,a._dataChannel=c,a._sctpStreamParameters=u,a._appData=p,a._handleDataChannel(),a}return a(r,[{key:"close",value:function(){this._closed||(d.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}},{key:"transportClosed",value:function(){this._closed||(d.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"_handleDataChannel",value:function(){var e=this;this._dataChannel.addEventListener("open",(function(){e._closed||(d.debug('DataChannel "open" event'),e.safeEmit("open"))})),this._dataChannel.addEventListener("error",(function(t){if(!e._closed){var r=t.error;r||(r=new Error("unknown DataChannel error")),"sctp-failure"===r.errorDetail?d.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",r.sctpCauseCode,r.message):d.error('DataChannel "error" event: %o',r),e.safeEmit("error",r)}})),this._dataChannel.addEventListener("close",(function(){e._closed||(d.warn('DataChannel "close" event'),e._closed=!0,e.emit("@close"),e.safeEmit("close"))})),this._dataChannel.addEventListener("message",(function(t){e._closed||e.safeEmit("message",t.data)}))}},{key:"id",get:function(){return this._id}},{key:"dataProducerId",get:function(){return this._dataProducerId}},{key:"closed",get:function(){return this._closed}},{key:"sctpStreamParameters",get:function(){return this._sctpStreamParameters}},{key:"readyState",get:function(){return this._dataChannel.readyState}},{key:"label",get:function(){return this._dataChannel.label}},{key:"protocol",get:function(){return this._dataChannel.protocol}},{key:"binaryType",get:function(){return this._dataChannel.binaryType},set:function(e){this._dataChannel.binaryType=e}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}},{key:"observer",get:function(){return this._observer}}]),r}(o.EnhancedEventEmitter);t.DataConsumer=u},function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach((function(e){r[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},function(e,t,r){var n=r(133),a=r(134),i=r(33),s=r(135);e.exports=function(e,t){return n(e)||a(e,t)||i(e,t)||s()}},function(e,t,r){var n=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,a="function"===typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function o(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(M){o=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),s=new T(n||[]);return i._invoke=function(e,t,r){var n=p;return function(a,i){if(n===f)throw new Error("Generator is already running");if(n===h){if("throw"===a)throw i;return E()}for(r.method=a,r.arg=i;;){var s=r.delegate;if(s){var c=R(s,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var o=u(e,t,r);if("normal"===o.type){if(n=r.done?h:l,o.arg===m)continue;return{value:o.arg,done:r.done}}"throw"===o.type&&(n=h,r.method="throw",r.arg=o.arg)}}}(e,r,s),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(M){return{type:"throw",arg:M}}}e.wrap=d;var p="suspendedStart",l="suspendedYield",f="executing",h="completed",m={};function v(){}function g(){}function y(){}var b={};b[i]=function(){return this};var _=Object.getPrototypeOf,w=_&&_(_(D([])));w&&w!==r&&n.call(w,i)&&(b=w);var k=y.prototype=v.prototype=Object.create(b);function S(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(a,i,s,c){var o=u(e[a],e,i);if("throw"!==o.type){var d=o.arg,p=d.value;return p&&"object"===typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){d.value=e,s(d)}),(function(e){return r("throw",e,s,c)}))}c(o.arg)}var a;this._invoke=function(e,n){function i(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(i,i):i()}}function R(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,R(e,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var a=u(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,m;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function D(e){if(e){var r=e[i];if(r)return r.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var a=-1,s=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:E}}function E(){return{value:t,done:!0}}return g.prototype=k.constructor=y,y.constructor=g,g.displayName=o(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,o(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},S(x.prototype),x.prototype[s]=function(){return this},e.AsyncIterator=x,e.async=function(t,r,n,a,i){void 0===i&&(i=Promise);var s=new x(d(t,r,n,a),i);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},S(k),o(k,c,"Generator"),k[i]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=D,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return c.type="throw",c.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],c=s.completion;if("root"===s.tryLoc)return a("end");if(s.tryLoc<=this.prev){var o=n.call(s,"catchLoc"),d=n.call(s,"finallyLoc");if(o&&d){if(this.prev<s.catchLoc)return a(s.catchLoc,!0);if(this.prev<s.finallyLoc)return a(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return a(s.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return a(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:D(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=n}catch(a){Function("r","regeneratorRuntime = r")(n)}},function(e,t,r){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=r(18),a=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var a=e.getVersionPrecision(t),i=e.getVersionPrecision(r),s=Math.max(a,i),c=0,o=e.map([t,r],(function(t){var r=s-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(c=s-Math.min(a,i)),s-=1;s>=c;){if(o[0][s]>o[1][s])return 1;if(o[0][s]===o[1][s]){if(s===c)return 0;s-=1}else if(o[0][s]<o[1][s])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var a=e[r];if(t(a,r))return a}},e.assign=function(e){for(var t,r,n=e,a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[e].concat(i));var c=function(){var e=i[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=i.length;t<r;t+=1)c();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=a,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,a=(n=r(91))&&n.__esModule?n:{default:n},i=r(18);function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(){}var t,r,n;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new a.default(e,t)},e.parse=function(e){return new a.default(e).getResult()},t=e,n=[{key:"BROWSER_MAP",get:function(){return i.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return i.ENGINE_MAP}},{key:"OS_MAP",get:function(){return i.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return i.PLATFORMS_MAP}}],(r=null)&&s(t.prototype,r),n&&s(t,n),e}();t.default=c,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=o(r(92)),a=o(r(93)),i=o(r(94)),s=o(r(95)),c=o(r(17));function o(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=c.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=c.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=c.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=c.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return c.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,a={},i=0;if(Object.keys(e).forEach((function(t){var s=e[t];"string"==typeof s?(a[t]=s,i+=1):"object"==typeof s&&(r[t]=s,n+=1)})),n>0){var s=Object.keys(r),o=c.default.find(s,(function(e){return t.isOS(e)}));if(o){var d=this.satisfies(r[o]);if(void 0!==d)return d}var u=c.default.find(s,(function(e){return t.isPlatform(e)}));if(u){var p=this.satisfies(r[u]);if(void 0!==p)return p}}if(i>0){var l=Object.keys(a),f=c.default.find(l,(function(e){return t.isBrowser(e,!0)}));if(void 0!==f)return this.compareVersion(a[f])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),a=c.default.getBrowserTypeByAlias(n);return t&&a&&(n=a.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,a=this.getBrowserVersion();if("string"==typeof a)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(c.default.compareVersions(a,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=d,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},i=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=a.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=a.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=a.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=a.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=a.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=a.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=a.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=a.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=a.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=a.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=a.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=a.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=a.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=a.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=a.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=a.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=a.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=a.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=a.default.getFirstMatch(i,e)||a.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=a.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=a.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=a.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=a.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=a.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=a.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=a.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=a.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=a.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=a.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:a.default.getFirstMatch(t,e),version:a.default.getSecondMatch(t,e)}}}];t.default=s,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},i=r(18),s=[{test:[/Roku\/DVP/],describe:function(e){var t=a.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:i.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=a.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=a.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=a.default.getWindowsVersionName(t);return{name:i.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:i.OS_MAP.iOS},r=a.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=a.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=a.default.getMacOSVersionName(t),n={name:i.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=a.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:i.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=a.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=a.default.getAndroidVersionName(t),n={name:i.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=a.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:i.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=a.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||a.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||a.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:i.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=a.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=a.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:i.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:i.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=a.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.PlayStation4,version:t}}}];t.default=s,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},i=r(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=a.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:i.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=a.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:i.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}}];t.default=s,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},i=r(18),s=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:i.ENGINE_MAP.Blink};var t=a.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:i.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:i.ENGINE_MAP.Trident},r=a.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:i.ENGINE_MAP.Presto},r=a.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:i.ENGINE_MAP.Gecko},r=a.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:i.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:i.ENGINE_MAP.WebKit},r=a.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=s,e.exports=t.default}})},function(e,t,r){var n=r(21);e.exports=function(e){function t(e){var r,n=null;function i(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];if(i.enabled){var s=i,c=Number(new Date),o=c-(r||c);s.diff=o,s.prev=r,s.curr=c,r=c,n[0]=t.coerce(n[0]),"string"!==typeof n[0]&&n.unshift("%O");var d=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return"%";d++;var a=t.formatters[r];if("function"===typeof a){var i=n[d];e=a.call(s,i),n.splice(d,1),d--}return e})),t.formatArgs.call(s,n);var u=s.log||t.log;u.apply(s,n)}}return i.namespace=e,i.useColors=t.useColors(),i.color=t.selectColor(e),i.extend=a,i.destroy=t.destroy,Object.defineProperty(i,"enabled",{enumerable:!0,configurable:!1,get:function(){return null===n?t.enabled(e):n},set:function(e){n=e}}),"function"===typeof t.init&&t.init(i),i}function a(e,r){var n=t(this.namespace+("undefined"===typeof r?":":r)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){var e=[].concat(n(t.names.map(i)),n(t.skips.map(i).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var r;t.save(e),t.names=[],t.skips=[];var n=("string"===typeof e?e:"").split(/[\s,]+/),a=n.length;for(r=0;r<a;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(22),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(r){t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},function(e,t,r){"use strict";var n,a="object"===typeof Reflect?Reflect:null,i=a&&"function"===typeof a.apply?a.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=a&&"function"===typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!==e};function c(){c.init.call(this)}e.exports=c,e.exports.once=function(e,t){return new Promise((function(r,n){function a(){void 0!==i&&e.removeListener("error",i),r([].slice.call(arguments))}var i;"error"!==t&&(i=function(r){e.removeListener(t,a),n(r)},e.once("error",i)),e.once(t,a)}))},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var o=10;function d(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function p(e,t,r,n){var a,i,s,c;if(d(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]),void 0===s)s=i[t]=r,++e._eventsCount;else if("function"===typeof s?s=i[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(a=u(e))>0&&s.length>a&&!s.warned){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=s.length,c=o,console&&console.warn&&console.warn(c)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},a=l.bind(n);return a.listener=r,n.wrapFn=a,a}function h(e,t,r){var n=e._events;if(void 0===n)return[];var a=n[t];return void 0===a?[]:"function"===typeof a?r?[a.listener||a]:[a]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(a):v(a,a.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"===typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!==typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return u(this)},c.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,a=this._events;if(void 0!==a)n=n&&void 0===a.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var c=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw c.context=s,c}var o=a[e];if(void 0===o)return!1;if("function"===typeof o)i(o,this,t);else{var d=o.length,u=v(o,d);for(r=0;r<d;++r)i(u[r],this,t)}return!0},c.prototype.addListener=function(e,t){return p(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return p(this,e,t,!0)},c.prototype.once=function(e,t){return d(t),this.on(e,f(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,f(this,e,t)),this},c.prototype.removeListener=function(e,t){var r,n,a,i,s;if(d(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!==typeof r){for(a=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,a=i;break}if(a<0)return this;0===a?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,a),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var a,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(a=i[n])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},c.prototype.listeners=function(e){return h(this,e,!0)},c.prototype.rawListeners=function(e){return h(this,e,!1)},c.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},c.prototype.listenerCount=m,c.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){var n=r(12),a=r(52),i=r(126),s=r(127);function c(t){var r="function"===typeof Map?new Map:void 0;return e.exports=c=function(e){if(null===e||!i(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return s(e,arguments,n(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),a(t,e)},c(t)}e.exports=c},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,r){var n=r(52),a=r(53);function i(t,r,s){return a()?e.exports=i=Reflect.construct:e.exports=i=function(e,t,r){var a=[null];a.push.apply(a,t);var i=new(Function.bind.apply(e,a));return r&&n(i,r.prototype),i},i.apply(null,arguments)}e.exports=i},function(e,t,r){var n=r(50),a=r(8),i=r(7),s=r(113)("h264-profile-level-id");s.log=console.info.bind(console);t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5;t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;var c=function e(t,r){"use strict";i(this,e),this.profile=t,this.level=r};t.ProfileLevelId=c;var o=new c(1,31),d=function(){"use strict";function e(t){i(this,e),this._mask=~l("x",t),this._maskedValue=l("1",t)}return a(e,[{key:"isMatch",value:function(e){return this._maskedValue===(e&this._mask)}}]),e}(),u=function e(t,r,n){"use strict";i(this,e),this.profile_idc=t,this.profile_iop=r,this.profile=n},p=[new u(66,new d("x1xx0000"),1),new u(77,new d("1xxx0000"),1),new u(88,new d("11xx0000"),1),new u(66,new d("x0xx0000"),2),new u(88,new d("10xx0000"),2),new u(77,new d("0x0x0000"),3),new u(100,new d("00000000"),5),new u(100,new d("00001100"),4)];function l(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function f(e,t){return function(e,t){return 0===e?10!==t&&0!==t:0===t?10!==e:e<t}(e,t)?e:t}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e["level-asymmetry-allowed"];return 1===t||"1"===t}t.parseProfileLevelId=function(e){if("string"!==typeof e||6!==e.length)return null;var t=parseInt(e,16);if(0===t)return null;var r,a=255&t,i=t>>8&255,o=t>>16&255;switch(a){case 11:r=0!==(16&i)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:r=a;break;default:return s("parseProfileLevelId() | unrecognized level_idc:%s",a),null}var d,u=n(p);try{for(u.s();!(d=u.n()).done;){var l=d.value;if(o===l.profile_idc&&l.profile_iop.isMatch(i))return new c(l.profile,r)}}catch(f){u.e(f)}finally{u.f()}return s("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return s("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}var t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return s("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}var r=e.level.toString(16);return 1===r.length&&(r="0".concat(r)),"".concat(t).concat(r)},t.parseSdpProfileLevelId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e["profile-level-id"];return r?t.parseProfileLevelId(r):o},t.isSameProfile=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.parseSdpProfileLevelId(e),a=t.parseSdpProfileLevelId(r);return Boolean(n&&a&&n.profile===a.profile)},t.generateProfileLevelIdForAnswer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e["profile-level-id"]&&!r["profile-level-id"])return s("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;var n=t.parseSdpProfileLevelId(e),a=t.parseSdpProfileLevelId(r);if(!n)throw new TypeError("invalid local_profile_level_id");if(!a)throw new TypeError("invalid remote_profile_level_id");if(n.profile!==a.profile)throw new TypeError("H264 Profile mismatch");var i=h(e)&&h(r),o=n.level,d=a.level,u=f(o,d),p=i?o:u;return s("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",n.profile,p),t.profileLevelIdToString(new c(n.profile,p))}},function(e,t,r){"use strict";var n=r(93),a=r(50),i=r(7),s=r(8),c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,i){function s(e){try{o(n.next(e))}catch(t){i(t)}}function c(e){try{o(n.throw(e))}catch(t){i(t)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}o((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ClosedErrorClass:Error,StoppedErrorClass:Error},r=t.ClosedErrorClass,n=void 0===r?Error:r,a=t.StoppedErrorClass,s=void 0===a?Error:a;i(this,e),this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=n,this.StoppedErrorClass=s}return s(e,[{key:"close",value:function(){if(!this.closed){this.closed=!0;var e,t=a(this.pendingTasks);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.stopped=!0,r.reject(new this.ClosedErrorClass("AwaitQueue closed"))}}catch(n){t.e(n)}finally{t.f()}this.pendingTasks.length=0}}},{key:"push",value:function(e,t){return c(this,void 0,void 0,n.mark((function r(){var a=this;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.closed){r.next=2;break}throw new this.ClosedErrorClass("AwaitQueue closed");case 2:if("function"===typeof e){r.next=4;break}throw new TypeError("given task is not a function");case 4:if(!e.name&&t)try{Object.defineProperty(e,"name",{value:t})}catch(n){}return r.abrupt("return",new Promise((function(r,n){var i={task:e,name:t,resolve:r,reject:n,stopped:!1,enqueuedAt:new Date,executedAt:void 0};a.pendingTasks.push(i),1===a.pendingTasks.length&&a.next()})));case 6:case"end":return r.stop()}}),r,this)})))}},{key:"stop",value:function(){if(!this.closed){var e,t=a(this.pendingTasks);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.stopped=!0,r.reject(new this.StoppedErrorClass("AwaitQueue stopped"))}}catch(n){t.e(n)}finally{t.f()}this.pendingTasks.length=0}}},{key:"dump",value:function(){var e=new Date;return this.pendingTasks.map((function(t){return{task:t.task,name:t.name,enqueuedTime:t.executedAt?t.executedAt.getTime()-t.enqueuedAt.getTime():e.getTime()-t.enqueuedAt.getTime(),executingTime:t.executedAt?e.getTime()-t.executedAt.getTime():0}}))}},{key:"next",value:function(){return c(this,void 0,void 0,n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.pendingTasks[0]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.executeTask(t);case 5:this.pendingTasks.shift(),this.next();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"executeTask",value:function(e){return c(this,void 0,void 0,n.mark((function t(){var r;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.stopped){t.next=2;break}return t.abrupt("return");case 2:return e.executedAt=new Date,t.prev=3,t.next=6,e.task();case 6:if(r=t.sent,!e.stopped){t.next=9;break}return t.abrupt("return");case 9:e.resolve(r),t.next=17;break;case 12:if(t.prev=12,t.t0=t.catch(3),!e.stopped){t.next=16;break}return t.abrupt("return");case 16:e.reject(t.t0);case 17:case"end":return t.stop()}}),t,null,[[3,12]])})))}},{key:"size",get:function(){return this.pendingTasks.length}}]),e}();t.AwaitQueue=o},function(e,t,r){"use strict";var n=r(50),a=r(93),i=r(95),s=r(7),c=r(8),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(99),p=r(94),l=r(96),f=r(97),h=r(102),m=r(106),v=r(100),g=r(103),y=r(110),b=new p.Logger("Chrome74"),_={OS:1024,MIS:1024},w=function(e){o(r,e);var t=d(r);function r(){var e;return s(this,r),(e=t.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return c(r,[{key:"close",value:function(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:function(){var e=i(a.mark((function e(){var t,r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(a){}return n=u.parse(r.sdp),i=h.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(s){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNativeSctpCapabilities",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:_});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,a=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,o=e.iceTransportPolicy,d=e.additionalSettings,u=e.proprietaryConstraints,p=e.extendedRtpCapabilities;b.debug("run()"),this._direction=r,this._remoteSdp=new g.RemoteSdp({iceParameters:n,iceCandidates:a,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:f.getSendingRtpParameters("audio",p),video:f.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:f.getSendingRemoteRtpParameters("audio",p),video:f.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},d),u),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=i(a.mark((function e(t){var r,n,i,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return s=e.sent,b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),e.next=27,this._pc.setLocalDescription(s);case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=i(a.mark((function e(t){var r,i,s,c,o,d,p,v,g,_,w,k,S,x,R,P,C,T;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,s=t.codecOptions,c=t.codec,this._assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),i&&i.length>1&&i.forEach((function(e,t){e.rid="r".concat(t)})),(o=l.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(o.codecs,c),(d=l.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(d.codecs,c),p=this._remoteSdp.getNextMediaSectionIdx(),v=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i}),e.next=12,this._pc.createOffer();case 12:if(g=e.sent,_=u.parse(g.sdp),this._transportReady){e.next=17;break}return e.next=17,this._setupTransport({localDtlsRole:"server",localSdpObject:_});case 17:return k=!1,S=y.parse((i||[{}])[0].scalabilityMode),i&&1===i.length&&S.spatialLayers>1&&"video/vp9"===o.codecs[0].mimeType.toLowerCase()&&(b.debug("send() | enabling legacy simulcast for VP9 SVC"),k=!0,_=u.parse(g.sdp),w=_.media[p.idx],m.addLegacySimulcast({offerMediaObject:w,numStreams:S.spatialLayers}),g={type:"offer",sdp:u.write(_)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),e.next=23,this._pc.setLocalDescription(g);case 23:if(x=v.mid,o.mid=x,_=u.parse(this._pc.localDescription.sdp),w=_.media[p.idx],o.rtcp.cname=h.getCname({offerMediaObject:w}),i?1===i.length?(R=m.getRtpEncodings({offerMediaObject:w}),Object.assign(R[0],i[0]),k&&(R=[R[0]]),o.encodings=R):o.encodings=i:o.encodings=m.getRtpEncodings({offerMediaObject:w}),o.encodings.length>1&&("video/vp8"===o.codecs[0].mimeType.toLowerCase()||"video/h264"===o.codecs[0].mimeType.toLowerCase())){P=n(o.encodings);try{for(P.s();!(C=P.n()).done;)C.value.scalabilityMode="S1T3"}catch(a){P.e(a)}finally{P.f()}}return this._remoteSdp.send({offerMediaObject:w,reuseMid:p.reuseMid,offerRtpParameters:o,answerRtpParameters:d,codecOptions:s,extmapAllowMixed:!0}),T={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",T),e.next=35,this._pc.setRemoteDescription(T);case 35:return this._mapMidTransceiver.set(x,v),e.abrupt("return",{localId:x,rtpParameters:o,rtpSender:v.sender});case 37:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),b.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid),e.next=10,this._pc.createOffer();case 10:return n=e.sent,b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return i={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=18,this._pc.setRemoteDescription(i);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=i(a.mark((function e(t,r){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?b.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):b.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=Object.assign(Object.assign({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,s=t.label,c=t.protocol,o=t.priority,this._assertSendDirection(),d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:c,priority:o},b.debug("sendDataChannel() [options:%o]",d),p=this._pc.createDataChannel(s,d),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,f=u.parse(l.sdp),h=f.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:f});case 15:return b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:h}),m={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),e.next=23,this._pc.setRemoteDescription(m);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),b.debug("receive() [trackId:%s, kind:%s]",r,n),s=i.mid||String(this._mapMidTransceiver.size),this._remoteSdp.receive({mid:s,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),c={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=9,this._pc.setRemoteDescription(c);case 9:return e.next=11,this._pc.createAnswer();case 11:if(o=e.sent,d=u.parse(o.sdp),p=d.media.find((function(e){return String(e.mid)===s})),h.applyCodecParameters({offerRtpParameters:i,answerMediaObject:p}),o={type:"answer",sdp:u.write(d)},this._transportReady){e.next=19;break}return e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:d});case 19:return b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),e.next=22,this._pc.setLocalDescription(o);case 22:if(l=this._pc.getTransceivers().find((function(e){return e.mid===s}))){e.next=25;break}throw new Error("new RTCRtpTransceiver not found");case 25:return this._mapMidTransceiver.set(s,l),e.abrupt("return",{localId:s,track:l.receiver.track,rtpReceiver:l.receiver});case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),b.debug("stopReceiving() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return this._remoteSdp.closeMediaSection(r.mid),n={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),e.next=10,this._pc.setRemoteDescription(n);case 10:return e.next=12,this._pc.createAnswer();case 12:return i=e.sent,b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),e.next=16,this._pc.setLocalDescription(i);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),s=r.streamId,c=r.ordered,o=r.maxPacketLifeTime,d=r.maxRetransmits,p={negotiated:!0,id:s,ordered:c,maxPacketLifeTime:o,maxRetransmits:d,protocol:i},b.debug("receiveDataChannel() [options:%o]",p),l=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=u.parse(h.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:m});case 19:return b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:l});case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setupTransport",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=u.parse(this._pc.localDescription.sdp)),(i=h.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Chrome74"}}],[{key:"createFactory",value:function(){return function(){return new r}}}]),r}(v.HandlerInterface);t.Chrome74=w},function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},a=function(e,t,r){var a=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:a&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:a?t[e.name]:t;!function(e,t,r,a){if(a&&!r)t[a]=n(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=n(e[i+1]))}(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=r(119),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach((function(e){var t=e[0],s=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var c=0;c<(i[t]||[]).length;c+=1){var o=i[t][c];if(o.reg.test(s))return a(o,n,s)}})),t.media=r,t};var c=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(c,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),a=0;a<r.length;a+=3)t.push({component:r[a],ip:r[a+1],port:r[a+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},function(e,t,r){var n=r(119),a=/%[sdv%]/g,i=function(e){var t=1,r=arguments,n=r.length;return e.replace(a,(function(e){if(t>=n)return e;var a=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(a);case"%d":return Number(a);case"%v":return""}}))},s=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var a=0;a<t.names.length;a+=1){var s=t.names[a];t.name?n.push(r[t.name][s]):n.push(r[t.names[a]])}else n.push(r[t.name]);return i.apply(null,n)},c=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||c,a=t.innerOrder||o,i=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(s(t,r,e))}))}))})),e.media.forEach((function(e){i.push(s("m",n.m[0],e)),a.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(s(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,i=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(o){a=!0,i=o}finally{try{n||null==c.return||c.return()}finally{if(a)throw i}}return r}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,r){"use strict";var n=r(9),a=r(10),i=r(50),s=r(7),c=r(8);Object.defineProperty(t,"__esModule",{value:!0});var o=r(96),d=function(){function e(t){var r=t.iceParameters,n=t.iceCandidates,a=t.dtlsParameters,c=t.planB,o=void 0!==c&&c;if(s(this,e),this._mediaObject={},this._planB=o,r&&this.setIceParameters(r),n){this._mediaObject.candidates=[];var d,u=i(n);try{for(u.s();!(d=u.n()).done;){var p=d.value,l={component:1};l.foundation=p.foundation,l.ip=p.ip,l.port=p.port,l.priority=p.priority,l.transport=p.protocol,l.type=p.type,p.tcpType&&(l.tcptype=p.tcpType),this._mediaObject.candidates.push(l)}}catch(f){u.e(f)}finally{u.f()}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}a&&this.setDtlsRole(a.role)}return c(e,[{key:"getObject",value:function(){return this._mediaObject}},{key:"setIceParameters",value:function(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}},{key:"disable",value:function(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}},{key:"close",value:function(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}},{key:"mid",get:function(){return String(this._mediaObject.mid)}},{key:"closed",get:function(){return 0===this._mediaObject.port}}]),e}();t.MediaSection=d;var u=function(e){n(r,e);var t=a(r);function r(e){var n,a=e.iceParameters,c=e.iceCandidates,d=e.dtlsParameters,u=e.sctpParameters,p=e.plainRtpParameters,f=e.planB,h=void 0!==f&&f,m=e.offerMediaObject,v=e.offerRtpParameters,g=e.answerRtpParameters,y=e.codecOptions,b=e.extmapAllowMixed,_=void 0!==b&&b;switch(s(this,r),(n=t.call(this,{iceParameters:a,iceCandidates:c,dtlsParameters:d,planB:h}))._mediaObject.mid=String(m.mid),n._mediaObject.type=m.type,n._mediaObject.protocol=m.protocol,p?(n._mediaObject.connection={ip:p.ip,version:p.ipVersion},n._mediaObject.port=p.port):(n._mediaObject.connection={ip:"127.0.0.1",version:4},n._mediaObject.port=7),m.type){case"audio":case"video":n._mediaObject.direction="recvonly",n._mediaObject.rtp=[],n._mediaObject.rtcpFb=[],n._mediaObject.fmtp=[];var w,k=i(g.codecs);try{var S=function(){var e=w.value,t={payload:e.payloadType,codec:l(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),n._mediaObject.rtp.push(t);var r=o.clone(e.parameters,{});if(y){var a=y.opusStereo,s=y.opusFec,c=y.opusDtx,d=y.opusMaxPlaybackRate,u=y.opusPtime,p=y.videoGoogleStartBitrate,f=y.videoGoogleMaxBitrate,h=y.videoGoogleMinBitrate,m=v.codecs.find((function(t){return t.payloadType===e.payloadType}));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==a&&(m.parameters["sprop-stereo"]=a?1:0,r.stereo=a?1:0),void 0!==s&&(m.parameters.useinbandfec=s?1:0,r.useinbandfec=s?1:0),void 0!==c&&(m.parameters.usedtx=c?1:0,r.usedtx=c?1:0),void 0!==d&&(r.maxplaybackrate=d),void 0!==u&&(m.parameters.ptime=u,r.ptime=u);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==p&&(r["x-google-start-bitrate"]=p),void 0!==f&&(r["x-google-max-bitrate"]=f),void 0!==h&&(r["x-google-min-bitrate"]=h)}}for(var g={payload:e.payloadType,config:""},b=0,_=Object.keys(r);b<_.length;b++){var k=_[b];g.config&&(g.config+=";"),g.config+="".concat(k,"=").concat(r[k])}g.config&&n._mediaObject.fmtp.push(g);var S,x=i(e.rtcpFeedback);try{for(x.s();!(S=x.n()).done;){var R=S.value;n._mediaObject.rtcpFb.push({payload:e.payloadType,type:R.type,subtype:R.parameter})}}catch(P){x.e(P)}finally{x.f()}};for(k.s();!(w=k.n()).done;)S()}catch(I){k.e(I)}finally{k.f()}n._mediaObject.payloads=g.codecs.map((function(e){return e.payloadType})).join(" "),n._mediaObject.ext=[];var x,R=i(g.headerExtensions);try{var P=function(){var e=x.value;if(!(m.ext||[]).some((function(t){return t.uri===e.uri})))return"continue";n._mediaObject.ext.push({uri:e.uri,value:e.id})};for(R.s();!(x=R.n()).done;)P()}catch(I){R.e(I)}finally{R.f()}if(_&&"extmap-allow-mixed"===m.extmapAllowMixed&&(n._mediaObject.extmapAllowMixed="extmap-allow-mixed"),m.simulcast){n._mediaObject.simulcast={dir1:"recv",list1:m.simulcast.list1},n._mediaObject.rids=[];var C,T=i(m.rids||[]);try{for(T.s();!(C=T.n()).done;){var D=C.value;"send"===D.direction&&n._mediaObject.rids.push({id:D.id,direction:"recv"})}}catch(I){T.e(I)}finally{T.f()}}else if(m.simulcast_03){n._mediaObject.simulcast_03={value:m.simulcast_03.value.replace(/send/g,"recv")},n._mediaObject.rids=[];var E,M=i(m.rids||[]);try{for(M.s();!(E=M.n()).done;){var O=E.value;"send"===O.direction&&n._mediaObject.rids.push({id:O.id,direction:"recv"})}}catch(I){M.e(I)}finally{M.f()}}n._mediaObject.rtcpMux="rtcp-mux",n._mediaObject.rtcpRsize="rtcp-rsize",n._planB&&"video"===n._mediaObject.type&&(n._mediaObject.xGoogleFlag="conference");break;case"application":"number"===typeof m.sctpPort?(n._mediaObject.payloads="webrtc-datachannel",n._mediaObject.sctpPort=u.port,n._mediaObject.maxMessageSize=u.maxMessageSize):m.sctpmap&&(n._mediaObject.payloads=u.port,n._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:u.port,maxMessageSize:u.maxMessageSize})}return n}return c(r,[{key:"setDtlsRole",value:function(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}}]),r}(d);t.AnswerMediaSection=u;var p=function(e){n(r,e);var t=a(r);function r(e){var n,a=e.iceParameters,c=e.iceCandidates,o=e.dtlsParameters,d=e.sctpParameters,u=e.plainRtpParameters,p=e.planB,f=void 0!==p&&p,h=e.mid,m=e.kind,v=e.offerRtpParameters,g=e.streamId,y=e.trackId,b=e.oldDataChannelSpec,_=void 0!==b&&b;switch(s(this,r),(n=t.call(this,{iceParameters:a,iceCandidates:c,dtlsParameters:o,planB:f}))._mediaObject.mid=String(h),n._mediaObject.type=m,u?(n._mediaObject.connection={ip:u.ip,version:u.ipVersion},n._mediaObject.protocol="RTP/AVP",n._mediaObject.port=u.port):(n._mediaObject.connection={ip:"127.0.0.1",version:4},n._mediaObject.protocol=d?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",n._mediaObject.port=7),m){case"audio":case"video":n._mediaObject.direction="sendonly",n._mediaObject.rtp=[],n._mediaObject.rtcpFb=[],n._mediaObject.fmtp=[],n._planB||(n._mediaObject.msid="".concat(g||"-"," ").concat(y));var w,k=i(v.codecs);try{for(k.s();!(w=k.n()).done;){var S=w.value,x={payload:S.payloadType,codec:l(S),rate:S.clockRate};S.channels>1&&(x.encoding=S.channels),n._mediaObject.rtp.push(x);for(var R={payload:S.payloadType,config:""},P=0,C=Object.keys(S.parameters);P<C.length;P++){var T=C[P];R.config&&(R.config+=";"),R.config+="".concat(T,"=").concat(S.parameters[T])}R.config&&n._mediaObject.fmtp.push(R);var D,E=i(S.rtcpFeedback);try{for(E.s();!(D=E.n()).done;){var M=D.value;n._mediaObject.rtcpFb.push({payload:S.payloadType,type:M.type,subtype:M.parameter})}}catch(B){E.e(B)}finally{E.f()}}}catch(B){k.e(B)}finally{k.f()}n._mediaObject.payloads=v.codecs.map((function(e){return e.payloadType})).join(" "),n._mediaObject.ext=[];var O,I=i(v.headerExtensions);try{for(I.s();!(O=I.n()).done;){var L=O.value;n._mediaObject.ext.push({uri:L.uri,value:L.id})}}catch(B){I.e(B)}finally{I.f()}n._mediaObject.rtcpMux="rtcp-mux",n._mediaObject.rtcpRsize="rtcp-rsize";var j=v.encodings[0],A=j.ssrc,F=j.rtx&&j.rtx.ssrc?j.rtx.ssrc:void 0;n._mediaObject.ssrcs=[],n._mediaObject.ssrcGroups=[],v.rtcp.cname&&n._mediaObject.ssrcs.push({id:A,attribute:"cname",value:v.rtcp.cname}),n._planB&&n._mediaObject.ssrcs.push({id:A,attribute:"msid",value:"".concat(g||"-"," ").concat(y)}),F&&(v.rtcp.cname&&n._mediaObject.ssrcs.push({id:F,attribute:"cname",value:v.rtcp.cname}),n._planB&&n._mediaObject.ssrcs.push({id:F,attribute:"msid",value:"".concat(g||"-"," ").concat(y)}),n._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(A," ").concat(F)}));break;case"application":_?(n._mediaObject.payloads=d.port,n._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:d.port,maxMessageSize:d.maxMessageSize}):(n._mediaObject.payloads="webrtc-datachannel",n._mediaObject.sctpPort=d.port,n._mediaObject.maxMessageSize=d.maxMessageSize)}return n}return c(r,[{key:"setDtlsRole",value:function(e){this._mediaObject.setup="actpass"}},{key:"planBReceive",value:function(e){var t=e.offerRtpParameters,r=e.streamId,n=e.trackId,a=t.encodings[0],i=a.ssrc,s=a.rtx&&a.rtx.ssrc?a.rtx.ssrc:void 0;t.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:t.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:"".concat(r||"-"," ").concat(n)}),s&&(t.rtcp.cname&&this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:t.rtcp.cname}),this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:"".concat(r||"-"," ").concat(n)}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(i," ").concat(s)}))}},{key:"planBStopReceiving",value:function(e){var t=e.offerRtpParameters.encodings[0],r=t.ssrc,n=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((function(e){return e.id!==r&&e.id!==n})),n&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((function(e){return e.ssrcs!=="".concat(r," ").concat(n)})))}}]),r}(d);function l(e){var t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.OfferMediaSection=p},function(e,t,r){"use strict";var n=r(50),a=r(93),i=r(95),s=r(7),c=r(8),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(99),p=r(94),l=r(96),f=r(97),h=r(102),m=r(106),v=r(100),g=r(103),y=r(110),b=new p.Logger("Chrome70"),_={OS:1024,MIS:1024},w=function(e){o(r,e);var t=d(r);function r(){var e;return s(this,r),(e=t.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return c(r,[{key:"close",value:function(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:function(){var e=i(a.mark((function e(){var t,r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(a){}return n=u.parse(r.sdp),i=h.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(s){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNativeSctpCapabilities",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:_});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,a=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,o=e.iceTransportPolicy,d=e.additionalSettings,u=e.proprietaryConstraints,p=e.extendedRtpCapabilities;b.debug("run()"),this._direction=r,this._remoteSdp=new g.RemoteSdp({iceParameters:n,iceCandidates:a,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:f.getSendingRtpParameters("audio",p),video:f.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:f.getSendingRemoteRtpParameters("audio",p),video:f.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},d),u),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=i(a.mark((function e(t){var r,n,i,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return s=e.sent,b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),e.next=27,this._pc.setLocalDescription(s);case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=i(a.mark((function e(t){var r,i,s,c,o,d,p,v,g,_,w,k,S,x,R,P,C,T,D,E,M,O;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,s=t.codecOptions,c=t.codec,this._assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),(o=l.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(o.codecs,c),(d=l.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(d.codecs,c),p=this._remoteSdp.getNextMediaSectionIdx(),v=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),e.next=11,this._pc.createOffer();case 11:if(g=e.sent,_=u.parse(g.sdp),this._transportReady){e.next=16;break}return e.next=16,this._setupTransport({localDtlsRole:"server",localSdpObject:_});case 16:return i&&i.length>1&&(b.debug("send() | enabling legacy simulcast"),_=u.parse(g.sdp),w=_.media[p.idx],m.addLegacySimulcast({offerMediaObject:w,numStreams:i.length}),g={type:"offer",sdp:u.write(_)}),k=!1,S=y.parse((i||[{}])[0].scalabilityMode),i&&1===i.length&&S.spatialLayers>1&&"video/vp9"===o.codecs[0].mimeType.toLowerCase()&&(b.debug("send() | enabling legacy simulcast for VP9 SVC"),k=!0,_=u.parse(g.sdp),w=_.media[p.idx],m.addLegacySimulcast({offerMediaObject:w,numStreams:S.spatialLayers}),g={type:"offer",sdp:u.write(_)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),e.next=23,this._pc.setLocalDescription(g);case 23:if(!i){e.next=38;break}b.debug("send() | applying given encodings"),x=v.sender.getParameters(),R=0;case 27:if(!(R<(x.encodings||[]).length)){e.next=36;break}if(P=x.encodings[R],C=i[R]){e.next=32;break}return e.abrupt("break",36);case 32:x.encodings[R]=Object.assign(P,C);case 33:++R,e.next=27;break;case 36:return e.next=38,v.sender.setParameters(x);case 38:if(T=v.mid,o.mid=T,_=u.parse(this._pc.localDescription.sdp),w=_.media[p.idx],o.rtcp.cname=h.getCname({offerMediaObject:w}),o.encodings=m.getRtpEncodings({offerMediaObject:w}),i)for(D=0;D<o.encodings.length;++D)i[D]&&Object.assign(o.encodings[D],i[D]);if(k&&(o.encodings=[o.encodings[0]]),o.encodings.length>1&&("video/vp8"===o.codecs[0].mimeType.toLowerCase()||"video/h264"===o.codecs[0].mimeType.toLowerCase())){E=n(o.encodings);try{for(E.s();!(M=E.n()).done;)M.value.scalabilityMode="S1T3"}catch(a){E.e(a)}finally{E.f()}}return this._remoteSdp.send({offerMediaObject:w,reuseMid:p.reuseMid,offerRtpParameters:o,answerRtpParameters:d,codecOptions:s}),O={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",O),e.next=52,this._pc.setRemoteDescription(O);case 52:return this._mapMidTransceiver.set(T,v),e.abrupt("return",{localId:T,rtpParameters:o,rtpSender:v.sender});case 54:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),b.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid),e.next=10,this._pc.createOffer();case 10:return n=e.sent,b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return i={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=18,this._pc.setRemoteDescription(i);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=i(a.mark((function e(t,r){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?b.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):b.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=Object.assign(Object.assign({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,s=t.label,c=t.protocol,o=t.priority,this._assertSendDirection(),d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:c,priority:o},b.debug("sendDataChannel() [options:%o]",d),p=this._pc.createDataChannel(s,d),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,f=u.parse(l.sdp),h=f.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:f});case 15:return b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:h}),m={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),e.next=23,this._pc.setRemoteDescription(m);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),b.debug("receive() [trackId:%s, kind:%s]",r,n),s=i.mid||String(this._mapMidTransceiver.size),this._remoteSdp.receive({mid:s,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),c={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=9,this._pc.setRemoteDescription(c);case 9:return e.next=11,this._pc.createAnswer();case 11:if(o=e.sent,d=u.parse(o.sdp),p=d.media.find((function(e){return String(e.mid)===s})),h.applyCodecParameters({offerRtpParameters:i,answerMediaObject:p}),o={type:"answer",sdp:u.write(d)},this._transportReady){e.next=19;break}return e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:d});case 19:return b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),e.next=22,this._pc.setLocalDescription(o);case 22:if(l=this._pc.getTransceivers().find((function(e){return e.mid===s}))){e.next=25;break}throw new Error("new RTCRtpTransceiver not found");case 25:return this._mapMidTransceiver.set(s,l),e.abrupt("return",{localId:s,track:l.receiver.track,rtpReceiver:l.receiver});case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),b.debug("stopReceiving() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return this._remoteSdp.closeMediaSection(r.mid),n={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),e.next=10,this._pc.setRemoteDescription(n);case 10:return e.next=12,this._pc.createAnswer();case 12:return i=e.sent,b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),e.next=16,this._pc.setLocalDescription(i);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),s=r.streamId,c=r.ordered,o=r.maxPacketLifeTime,d=r.maxRetransmits,p={negotiated:!0,id:s,ordered:c,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:d,protocol:i},b.debug("receiveDataChannel() [options:%o]",p),l=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=u.parse(h.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:m});case 19:return b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:l});case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setupTransport",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=u.parse(this._pc.localDescription.sdp)),(i=h.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Chrome70"}}],[{key:"createFactory",value:function(){return function(){return new r}}}]),r}(v.HandlerInterface);t.Chrome70=w},function(e,t,r){"use strict";var n=r(50),a=r(93),i=r(95),s=r(7),c=r(8),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(99),p=r(94),l=r(96),f=r(97),h=r(102),m=r(107),v=r(100),g=r(103),y=new p.Logger("Chrome67"),b={OS:1024,MIS:1024},_=function(e){o(r,e);var t=d(r);function r(){var e;return s(this,r),(e=t.call(this))._sendStream=new MediaStream,e._mapSendLocalIdRtpSender=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return c(r,[{key:"close",value:function(){if(y.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:function(){var e=i(a.mark((function e(){var t,r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(a){}return n=u.parse(r.sdp),i=h.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(s){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNativeSctpCapabilities",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:b});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,a=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,o=e.iceTransportPolicy,d=e.additionalSettings,u=e.proprietaryConstraints,p=e.extendedRtpCapabilities;y.debug("run()"),this._direction=r,this._remoteSdp=new g.RemoteSdp({iceParameters:n,iceCandidates:a,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:f.getSendingRtpParameters("audio",p),video:f.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:f.getSendingRemoteRtpParameters("audio",p),video:f.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},d),u),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=i(a.mark((function e(t){var r,n,i,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return s=e.sent,y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),e.next=27,this._pc.setLocalDescription(s);case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=i(a.mark((function e(t){var r,i,s,c,o,d,p,v,g,b,_,w,k,S,x;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,s=t.codecOptions,c=t.codec,this._assertSendDirection(),y.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),c&&y.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addTrack(r,this._sendStream),e.next=8,this._pc.createOffer();case 8:if(o=e.sent,d=u.parse(o.sdp),(v=l.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(v.codecs),(g=l.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(g.codecs),this._transportReady){e.next=17;break}return e.next=17,this._setupTransport({localDtlsRole:"server",localSdpObject:d});case 17:return"video"===r.kind&&i&&i.length>1&&(y.debug("send() | enabling simulcast"),d=u.parse(o.sdp),p=d.media.find((function(e){return"video"===e.type})),m.addLegacySimulcast({offerMediaObject:p,track:r,numStreams:i.length}),o={type:"offer",sdp:u.write(d)}),y.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),e.next=21,this._pc.setLocalDescription(o);case 21:if(d=u.parse(this._pc.localDescription.sdp),p=d.media.find((function(e){return e.type===r.kind})),v.rtcp.cname=h.getCname({offerMediaObject:p}),v.encodings=m.getRtpEncodings({offerMediaObject:p,track:r}),i)for(b=0;b<v.encodings.length;++b)i[b]&&Object.assign(v.encodings[b],i[b]);if(v.encodings.length>1&&"video/vp8"===v.codecs[0].mimeType.toLowerCase()){_=n(v.encodings);try{for(_.s();!(w=_.n()).done;)w.value.scalabilityMode="S1T3"}catch(a){_.e(a)}finally{_.f()}}return this._remoteSdp.send({offerMediaObject:p,offerRtpParameters:v,answerRtpParameters:g,codecOptions:s}),k={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),e.next=32,this._pc.setRemoteDescription(k);case 32:return S=String(this._nextSendLocalId),this._nextSendLocalId++,x=this._pc.getSenders().find((function(e){return e.track===r})),this._mapSendLocalIdRtpSender.set(S,x),e.abrupt("return",{localId:S,rtpParameters:v,rtpSender:x});case 37:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),y.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return this._pc.removeTrack(r),r.track&&this._sendStream.removeTrack(r.track),this._mapSendLocalIdRtpSender.delete(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,y.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return y.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return i={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=29,this._pc.setRemoteDescription(i);case 29:case"end":return e.stop()}}),e,this,[[12,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?y.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):y.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return i=n.track,e.next=8,n.replaceTrack(r);case 8:i&&this._sendStream.removeTrack(i),r&&this._sendStream.addTrack(r);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),y.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),y.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=Object.assign(Object.assign({},e),r)})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return e.abrupt("return",r.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,s=t.label,c=t.protocol,o=t.priority,this._assertSendDirection(),d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:c,priority:o},y.debug("sendDataChannel() [options:%o]",d),p=this._pc.createDataChannel(s,d),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%b.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,f=u.parse(l.sdp),h=f.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:f});case 15:return y.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:h}),m={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),e.next=23,this._pc.setRemoteDescription(m);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),y.debug("receive() [trackId:%s, kind:%s]",r,n),s=r,c=n,this._remoteSdp.receive({mid:c,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),o={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=10,this._pc.setRemoteDescription(o);case 10:return e.next=12,this._pc.createAnswer();case 12:if(d=e.sent,p=u.parse(d.sdp),l=p.media.find((function(e){return String(e.mid)===c})),h.applyCodecParameters({offerRtpParameters:i,answerMediaObject:l}),d={type:"answer",sdp:u.write(p)},this._transportReady){e.next=20;break}return e.next=20,this._setupTransport({localDtlsRole:"client",localSdpObject:p});case 20:return y.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),e.next=23,this._pc.setLocalDescription(d);case 23:if(f=this._pc.getReceivers().find((function(e){return e.track&&e.track.id===s}))){e.next=26;break}throw new Error("new RTCRtpReceiver not");case 26:return this._mapRecvLocalIdInfo.set(s,{mid:c,rtpParameters:i,rtpReceiver:f}),e.abrupt("return",{localId:s,track:f.track,rtpReceiver:f});case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertRecvDirection(),y.debug("stopReceiving() [localId:%s]",t),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.mid,i=r.rtpParameters,this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:n,offerRtpParameters:i}),s={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=9,this._pc.setRemoteDescription(s);case 9:return e.next=11,this._pc.createAnswer();case 11:return c=e.sent,y.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=15,this._pc.setLocalDescription(c);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=i(a.mark((function e(t){var r,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.rtpReceiver){e.next=4;break}throw new Error("associated RTCRtpReceiver not found");case 4:return e.abrupt("return",n.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),s=r.streamId,c=r.ordered,o=r.maxPacketLifeTime,d=r.maxRetransmits,p={negotiated:!0,id:s,ordered:c,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:d,protocol:i},y.debug("receiveDataChannel() [options:%o]",p),l=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=u.parse(h.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:m});case 19:return y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:l});case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setupTransport",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=u.parse(this._pc.localDescription.sdp)),(i=h.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Chrome67"}}],[{key:"createFactory",value:function(){return function(){return new r}}}]),r}(v.HandlerInterface);t.Chrome67=_},function(e,t,r){"use strict";var n=r(50),a=r(93),i=r(95),s=r(7),c=r(8),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(99),p=r(94),l=r(98),f=r(96),h=r(97),m=r(102),v=r(107),g=r(100),y=r(103),b=new p.Logger("Chrome55"),_={OS:1024,MIS:1024},w=function(e){o(r,e);var t=d(r);function r(){var e;return s(this,r),(e=t.call(this))._sendStream=new MediaStream,e._mapSendLocalIdTrack=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return c(r,[{key:"close",value:function(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:function(){var e=i(a.mark((function e(){var t,r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(a){}return n=u.parse(r.sdp),i=m.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(s){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNativeSctpCapabilities",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:_});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,a=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,o=e.iceTransportPolicy,d=e.additionalSettings,u=e.proprietaryConstraints,p=e.extendedRtpCapabilities;b.debug("run()"),this._direction=r,this._remoteSdp=new y.RemoteSdp({iceParameters:n,iceCandidates:a,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:h.getSendingRtpParameters("audio",p),video:h.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:h.getSendingRemoteRtpParameters("audio",p),video:h.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},d),u),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=i(a.mark((function e(t){var r,n,i,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return s=e.sent,b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),e.next=27,this._pc.setLocalDescription(s);case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=i(a.mark((function e(t){var r,i,s,c,o,d,p,l,g,y,_,w,k,S;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,s=t.codecOptions,c=t.codec,this._assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),c&&b.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addStream(this._sendStream),e.next=8,this._pc.createOffer();case 8:if(o=e.sent,d=u.parse(o.sdp),(l=f.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=h.reduceCodecs(l.codecs),(g=f.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=h.reduceCodecs(g.codecs),this._transportReady){e.next=17;break}return e.next=17,this._setupTransport({localDtlsRole:"server",localSdpObject:d});case 17:return"video"===r.kind&&i&&i.length>1&&(b.debug("send() | enabling simulcast"),d=u.parse(o.sdp),p=d.media.find((function(e){return"video"===e.type})),v.addLegacySimulcast({offerMediaObject:p,track:r,numStreams:i.length}),o={type:"offer",sdp:u.write(d)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),e.next=21,this._pc.setLocalDescription(o);case 21:if(d=u.parse(this._pc.localDescription.sdp),p=d.media.find((function(e){return e.type===r.kind})),l.rtcp.cname=m.getCname({offerMediaObject:p}),l.encodings=v.getRtpEncodings({offerMediaObject:p,track:r}),i)for(y=0;y<l.encodings.length;++y)i[y]&&Object.assign(l.encodings[y],i[y]);if(l.encodings.length>1&&"video/vp8"===l.codecs[0].mimeType.toLowerCase()){_=n(l.encodings);try{for(_.s();!(w=_.n()).done;)w.value.scalabilityMode="S1T3"}catch(a){_.e(a)}finally{_.f()}}return this._remoteSdp.send({offerMediaObject:p,offerRtpParameters:l,answerRtpParameters:g,codecOptions:s}),k={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),e.next=32,this._pc.setRemoteDescription(k);case 32:return S=String(this._nextSendLocalId),this._nextSendLocalId++,this._mapSendLocalIdTrack.set(S,r),e.abrupt("return",{localId:S,rtpParameters:l});case 36:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),b.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdTrack.get(t)){e.next=5;break}throw new Error("track not found");case 5:return this._mapSendLocalIdTrack.delete(t),this._sendStream.removeTrack(r),this._pc.addStream(this._sendStream),e.next=10,this._pc.createOffer();case 10:return n=e.sent,b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return b.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return i={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=29,this._pc.setRemoteDescription(i);case 29:case"end":return e.stop()}}),e,this,[[12,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=i(a.mark((function e(t,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=i(a.mark((function e(t,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError(" not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=i(a.mark((function e(t,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=i(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,s=t.label,c=t.protocol,o=t.priority,this._assertSendDirection(),d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:c,priority:o},b.debug("sendDataChannel() [options:%o]",d),p=this._pc.createDataChannel(s,d),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,f=u.parse(l.sdp),h=f.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:f});case 15:return b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:h}),m={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),e.next=23,this._pc.setRemoteDescription(m);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),b.debug("receive() [trackId:%s, kind:%s]",r,n),s=r,c=n,o=i.rtcp.cname,this._remoteSdp.receive({mid:c,kind:n,offerRtpParameters:i,streamId:o,trackId:r}),d={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),e.next=11,this._pc.setRemoteDescription(d);case 11:return e.next=13,this._pc.createAnswer();case 13:if(p=e.sent,l=u.parse(p.sdp),f=l.media.find((function(e){return String(e.mid)===c})),m.applyCodecParameters({offerRtpParameters:i,answerMediaObject:f}),p={type:"answer",sdp:u.write(l)},this._transportReady){e.next=21;break}return e.next=21,this._setupTransport({localDtlsRole:"client",localSdpObject:l});case 21:return b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",p),e.next=24,this._pc.setLocalDescription(p);case 24:if(h=this._pc.getRemoteStreams().find((function(e){return e.id===o})),v=h.getTrackById(s)){e.next=28;break}throw new Error("remote track not found");case 28:return this._mapRecvLocalIdInfo.set(s,{mid:c,rtpParameters:i}),e.abrupt("return",{localId:s,track:v});case 30:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertRecvDirection(),b.debug("stopReceiving() [localId:%s]",t),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.mid,i=r.rtpParameters,this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:n,offerRtpParameters:i}),s={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=9,this._pc.setRemoteDescription(s);case 9:return e.next=11,this._pc.createAnswer();case 11:return c=e.sent,b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=15,this._pc.setLocalDescription(c);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=i(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),s=r.streamId,c=r.ordered,o=r.maxPacketLifeTime,d=r.maxRetransmits,p={negotiated:!0,id:s,ordered:c,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:d,protocol:i},b.debug("receiveDataChannel() [options:%o]",p),l=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=u.parse(h.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:m});case 19:return b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:l});case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setupTransport",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=u.parse(this._pc.localDescription.sdp)),(i=m.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Chrome55"}}],[{key:"createFactory",value:function(){return function(){return new r}}}]),r}(g.HandlerInterface);t.Chrome55=w},function(e,t,r){"use strict";var n=r(50),a=r(93),i=r(95),s=r(7),c=r(8),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(99),p=r(94),l=r(98),f=r(96),h=r(97),m=r(102),v=r(106),g=r(100),y=r(103),b=new p.Logger("Firefox60"),_={OS:16,MIS:2048},w=function(e){o(r,e);var t=d(r);function r(){var e;return s(this,r),(e=t.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return c(r,[{key:"close",value:function(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:function(){var e=i(a.mark((function e(){var t,r,n,i,s,c,o,d,p,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),(r=document.createElement("canvas")).getContext("2d"),n=r.captureStream(),i=n.getVideoTracks()[0],e.prev=6,t.addTransceiver("audio",{direction:"sendrecv"}),s=t.addTransceiver(i,{direction:"sendrecv"}),c=s.sender.getParameters(),o=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}],c.encodings=o,e.next=14,s.sender.setParameters(c);case 14:return e.next=16,t.createOffer();case 16:d=e.sent;try{r.remove()}catch(a){}try{i.stop()}catch(a){}try{t.close()}catch(a){}return p=u.parse(d.sdp),l=m.extractRtpCapabilities({sdpObject:p}),e.abrupt("return",l);case 25:e.prev=25,e.t0=e.catch(6);try{r.remove()}catch(f){}try{i.stop()}catch(f){}try{t.close()}catch(f){}throw e.t0;case 31:case"end":return e.stop()}}),e,null,[[6,25]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNativeSctpCapabilities",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:_});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,a=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,o=e.iceTransportPolicy,d=e.additionalSettings,u=e.proprietaryConstraints,p=e.extendedRtpCapabilities;b.debug("run()"),this._direction=r,this._remoteSdp=new y.RemoteSdp({iceParameters:n,iceCandidates:a,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:h.getSendingRtpParameters("audio",p),video:h.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:h.getSendingRemoteRtpParameters("audio",p),video:h.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},d),u),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:function(){var e=i(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=i(a.mark((function e(t){var r,n,i,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return s=e.sent,b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),e.next=27,this._pc.setLocalDescription(s);case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=i(a.mark((function e(t){var r,i,s,c,o,d,p,l,g,y,_,w,k,S,x,R,P;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,i=t.encodings,s=t.codecOptions,c=t.codec,this._assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),i&&i.length>1&&(i.forEach((function(e,t){e.rid="r".concat(t)})),o=f.clone(i,[]).reverse()),(d=f.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=h.reduceCodecs(d.codecs,c),(p=f.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=h.reduceCodecs(p.codecs,c),l=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),!o){e.next=14;break}return(g=l.sender.getParameters()).encodings=o,e.next=14,l.sender.setParameters(g);case 14:return e.next=16,this._pc.createOffer();case 16:if(y=e.sent,_=u.parse(y.sdp),this._transportReady){e.next=21;break}return e.next=21,this._setupTransport({localDtlsRole:"client",localSdpObject:_});case 21:return b.debug("send() | calling pc.setLocalDescription() [offer:%o]",y),e.next=24,this._pc.setLocalDescription(y);case 24:if(w=l.mid,d.mid=w,_=u.parse(this._pc.localDescription.sdp),k=_.media[_.media.length-1],d.rtcp.cname=m.getCname({offerMediaObject:k}),i?1===i.length?(S=v.getRtpEncodings({offerMediaObject:k}),Object.assign(S[0],i[0]),d.encodings=S):d.encodings=i:d.encodings=v.getRtpEncodings({offerMediaObject:k}),d.encodings.length>1&&("video/vp8"===d.codecs[0].mimeType.toLowerCase()||"video/h264"===d.codecs[0].mimeType.toLowerCase())){x=n(d.encodings);try{for(x.s();!(R=x.n()).done;)R.value.scalabilityMode="S1T3"}catch(a){x.e(a)}finally{x.f()}}return this._remoteSdp.send({offerMediaObject:k,offerRtpParameters:d,answerRtpParameters:p,codecOptions:s,extmapAllowMixed:!0}),P={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",P),e.next=36,this._pc.setRemoteDescription(P);case 36:return this._mapMidTransceiver.set(w,l),e.abrupt("return",{localId:w,rtpParameters:d,rtpSender:l.sender});case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated transceiver not found");case 4:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid),e.next=9,this._pc.createOffer();case 9:return n=e.sent,b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=i(a.mark((function e(t,r){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?b.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):b.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated transceiver not found");case 5:return i=n.sender.getParameters(),r=i.encodings.length-1-r,i.encodings.forEach((function(e,t){e.active=t>=r})),e.next=10,n.sender.setParameters(i);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=Object.assign(Object.assign({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,s=t.label,c=t.protocol,o=t.priority,this._assertSendDirection(),d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:c,priority:o},b.debug("sendDataChannel() [options:%o]",d),p=this._pc.createDataChannel(s,d),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,f=u.parse(l.sdp),h=f.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:f});case 15:return b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:h}),m={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),e.next=23,this._pc.setRemoteDescription(m);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),b.debug("receive() [trackId:%s, kind:%s]",r,n),s=i.mid||String(this._mapMidTransceiver.size),this._remoteSdp.receive({mid:s,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),c={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=9,this._pc.setRemoteDescription(c);case 9:return e.next=11,this._pc.createAnswer();case 11:if(o=e.sent,d=u.parse(o.sdp),p=d.media.find((function(e){return String(e.mid)===s})),m.applyCodecParameters({offerRtpParameters:i,answerMediaObject:p}),o={type:"answer",sdp:u.write(d)},this._transportReady){e.next=19;break}return e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:d});case 19:return b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),e.next=22,this._pc.setLocalDescription(o);case 22:if(l=this._pc.getTransceivers().find((function(e){return e.mid===s}))){e.next=25;break}throw new Error("new RTCRtpTransceiver not found");case 25:return this._mapMidTransceiver.set(s,l),e.abrupt("return",{localId:s,track:l.receiver.track,rtpReceiver:l.receiver});case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),b.debug("stopReceiving() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return this._remoteSdp.closeMediaSection(r.mid),n={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),e.next=10,this._pc.setRemoteDescription(n);case 10:return e.next=12,this._pc.createAnswer();case 12:return i=e.sent,b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),e.next=16,this._pc.setLocalDescription(i);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),s=r.streamId,c=r.ordered,o=r.maxPacketLifeTime,d=r.maxRetransmits,p={negotiated:!0,id:s,ordered:c,maxPacketLifeTime:o,maxRetransmits:d,protocol:i},b.debug("receiveDataChannel() [options:%o]",p),l=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=u.parse(h.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:m});case 19:return b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:l});case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setupTransport",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=u.parse(this._pc.localDescription.sdp)),(i=m.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Firefox60"}}],[{key:"createFactory",value:function(){return function(){return new r}}}]),r}(g.HandlerInterface);t.Firefox60=w},function(e,t,r){"use strict";var n=r(50),a=r(93),i=r(95),s=r(7),c=r(8),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(99),p=r(94),l=r(96),f=r(97),h=r(102),m=r(106),v=r(100),g=r(103),y=new p.Logger("Safari12"),b={OS:1024,MIS:1024},_=function(e){o(r,e);var t=d(r);function r(){var e;return s(this,r),(e=t.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return c(r,[{key:"close",value:function(){if(y.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:function(){var e=i(a.mark((function e(){var t,r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(a){}return n=u.parse(r.sdp),i=h.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(s){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNativeSctpCapabilities",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:b});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,a=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,o=e.iceTransportPolicy,d=e.additionalSettings,u=e.proprietaryConstraints,p=e.extendedRtpCapabilities;y.debug("run()"),this._direction=r,this._remoteSdp=new g.RemoteSdp({iceParameters:n,iceCandidates:a,dtlsParameters:i,sctpParameters:s}),this._sendingRtpParametersByKind={audio:f.getSendingRtpParameters("audio",p),video:f.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:f.getSendingRemoteRtpParameters("audio",p),video:f.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},d),u),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=i(a.mark((function e(t){var r,n,i,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return s=e.sent,y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),e.next=27,this._pc.setLocalDescription(s);case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=i(a.mark((function e(t){var r,i,s,c,o,d,p,v,g,b,_,w,k,S,x,R;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,s=t.codecOptions,c=t.codec,this._assertSendDirection(),y.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),(o=l.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(o.codecs,c),(d=l.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(d.codecs,c),p=this._remoteSdp.getNextMediaSectionIdx(),v=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),e.next=11,this._pc.createOffer();case 11:if(g=e.sent,b=u.parse(g.sdp),this._transportReady){e.next=16;break}return e.next=16,this._setupTransport({localDtlsRole:"server",localSdpObject:b});case 16:return i&&i.length>1&&(y.debug("send() | enabling legacy simulcast"),b=u.parse(g.sdp),_=b.media[p.idx],m.addLegacySimulcast({offerMediaObject:_,numStreams:i.length}),g={type:"offer",sdp:u.write(b)}),y.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),e.next=20,this._pc.setLocalDescription(g);case 20:if(w=v.mid,o.mid=w,b=u.parse(this._pc.localDescription.sdp),_=b.media[p.idx],o.rtcp.cname=h.getCname({offerMediaObject:_}),o.encodings=m.getRtpEncodings({offerMediaObject:_}),i)for(k=0;k<o.encodings.length;++k)i[k]&&Object.assign(o.encodings[k],i[k]);if(o.encodings.length>1&&("video/vp8"===o.codecs[0].mimeType.toLowerCase()||"video/h264"===o.codecs[0].mimeType.toLowerCase())){S=n(o.encodings);try{for(S.s();!(x=S.n()).done;)x.value.scalabilityMode="S1T3"}catch(a){S.e(a)}finally{S.f()}}return this._remoteSdp.send({offerMediaObject:_,reuseMid:p.reuseMid,offerRtpParameters:o,answerRtpParameters:d,codecOptions:s}),R={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("send() | calling pc.setRemoteDescription() [answer:%o]",R),e.next=33,this._pc.setRemoteDescription(R);case 33:return this._mapMidTransceiver.set(w,v),e.abrupt("return",{localId:w,rtpParameters:o,rtpSender:v.sender});case 35:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),y.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid),e.next=10,this._pc.createOffer();case 10:return n=e.sent,y.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return i={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=18,this._pc.setRemoteDescription(i);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=i(a.mark((function e(t,r){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?y.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):y.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),y.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),y.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=Object.assign(Object.assign({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,s=t.label,c=t.protocol,o=t.priority,this._assertSendDirection(),d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:c,priority:o},y.debug("sendDataChannel() [options:%o]",d),p=this._pc.createDataChannel(s,d),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%b.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,f=u.parse(l.sdp),h=f.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:f});case 15:return y.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:h}),m={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),e.next=23,this._pc.setRemoteDescription(m);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),y.debug("receive() [trackId:%s, kind:%s]",r,n),s=i.mid||String(this._mapMidTransceiver.size),this._remoteSdp.receive({mid:s,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),c={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=9,this._pc.setRemoteDescription(c);case 9:return e.next=11,this._pc.createAnswer();case 11:if(o=e.sent,d=u.parse(o.sdp),p=d.media.find((function(e){return String(e.mid)===s})),h.applyCodecParameters({offerRtpParameters:i,answerMediaObject:p}),o={type:"answer",sdp:u.write(d)},this._transportReady){e.next=19;break}return e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:d});case 19:return y.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),e.next=22,this._pc.setLocalDescription(o);case 22:if(l=this._pc.getTransceivers().find((function(e){return e.mid===s}))){e.next=25;break}throw new Error("new RTCRtpTransceiver not found");case 25:return this._mapMidTransceiver.set(s,l),e.abrupt("return",{localId:s,track:l.receiver.track,rtpReceiver:l.receiver});case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),y.debug("stopReceiving() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return this._remoteSdp.closeMediaSection(r.mid),n={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),e.next=10,this._pc.setRemoteDescription(n);case 10:return e.next=12,this._pc.createAnswer();case 12:return i=e.sent,y.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),e.next=16,this._pc.setLocalDescription(i);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),s=r.streamId,c=r.ordered,o=r.maxPacketLifeTime,d=r.maxRetransmits,p={negotiated:!0,id:s,ordered:c,maxPacketLifeTime:o,maxRetransmits:d,protocol:i},y.debug("receiveDataChannel() [options:%o]",p),l=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),f={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=u.parse(h.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:m});case 19:return y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:l});case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setupTransport",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=u.parse(this._pc.localDescription.sdp)),(i=h.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Safari12"}}],[{key:"createFactory",value:function(){return function(){return new r}}}]),r}(v.HandlerInterface);t.Safari12=_},function(e,t,r){"use strict";var n=r(50),a=r(93),i=r(95),s=r(7),c=r(8),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(99),p=r(94),l=r(96),f=r(97),h=r(102),m=r(107),v=r(100),g=r(103),y=new p.Logger("Safari11"),b={OS:1024,MIS:1024},_=function(e){o(r,e);var t=d(r);function r(){var e;return s(this,r),(e=t.call(this))._sendStream=new MediaStream,e._mapSendLocalIdRtpSender=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return c(r,[{key:"close",value:function(){if(y.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:function(){var e=i(a.mark((function e(){var t,r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(a){}return n=u.parse(r.sdp),i=h.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(s){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNativeSctpCapabilities",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:b});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,a=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,o=e.iceTransportPolicy,d=e.additionalSettings,u=e.proprietaryConstraints,p=e.extendedRtpCapabilities;y.debug("run()"),this._direction=r,this._remoteSdp=new g.RemoteSdp({iceParameters:n,iceCandidates:a,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:f.getSendingRtpParameters("audio",p),video:f.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:f.getSendingRemoteRtpParameters("audio",p),video:f.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},d),u),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=i(a.mark((function e(t){var r,n,i,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return s=e.sent,y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),e.next=27,this._pc.setLocalDescription(s);case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=i(a.mark((function e(t){var r,i,s,c,o,d,p,v,g,b,_,w,k,S,x;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,s=t.codecOptions,c=t.codec,this._assertSendDirection(),y.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),c&&y.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addTrack(r,this._sendStream),e.next=8,this._pc.createOffer();case 8:if(o=e.sent,d=u.parse(o.sdp),(v=l.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(v.codecs),(g=l.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(g.codecs),this._transportReady){e.next=17;break}return e.next=17,this._setupTransport({localDtlsRole:"server",localSdpObject:d});case 17:return"video"===r.kind&&i&&i.length>1&&(y.debug("send() | enabling simulcast"),d=u.parse(o.sdp),p=d.media.find((function(e){return"video"===e.type})),m.addLegacySimulcast({offerMediaObject:p,track:r,numStreams:i.length}),o={type:"offer",sdp:u.write(d)}),y.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),e.next=21,this._pc.setLocalDescription(o);case 21:if(d=u.parse(this._pc.localDescription.sdp),p=d.media.find((function(e){return e.type===r.kind})),v.rtcp.cname=h.getCname({offerMediaObject:p}),v.encodings=m.getRtpEncodings({offerMediaObject:p,track:r}),i)for(b=0;b<v.encodings.length;++b)i[b]&&Object.assign(v.encodings[b],i[b]);if(v.encodings.length>1&&"video/vp8"===v.codecs[0].mimeType.toLowerCase()){_=n(v.encodings);try{for(_.s();!(w=_.n()).done;)w.value.scalabilityMode="S1T3"}catch(a){_.e(a)}finally{_.f()}}return this._remoteSdp.send({offerMediaObject:p,offerRtpParameters:v,answerRtpParameters:g,codecOptions:s}),k={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),e.next=32,this._pc.setRemoteDescription(k);case 32:return S=String(this._nextSendLocalId),this._nextSendLocalId++,x=this._pc.getSenders().find((function(e){return e.track===r})),this._mapSendLocalIdRtpSender.set(S,x),e.abrupt("return",{localId:S,rtpParameters:v,rtpSender:x});case 37:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return r.track&&this._sendStream.removeTrack(r.track),this._mapSendLocalIdRtpSender.delete(t),e.next=8,this._pc.createOffer();case 8:return n=e.sent,y.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=10,e.next=13,this._pc.setLocalDescription(n);case 13:e.next=21;break;case 15:if(e.prev=15,e.t0=e.catch(10),0!==this._sendStream.getTracks().length){e.next=20;break}return y.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 20:throw e.t0;case 21:if("stable"!==this._pc.signalingState){e.next=23;break}return e.abrupt("return");case 23:return i={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=27,this._pc.setRemoteDescription(i);case 27:case"end":return e.stop()}}),e,this,[[10,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?y.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):y.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return i=n.track,e.next=8,n.replaceTrack(r);case 8:i&&this._sendStream.removeTrack(i),r&&this._sendStream.addTrack(r);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),y.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=i(a.mark((function e(t,r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),y.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=Object.assign(Object.assign({},e),r)})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return e.abrupt("return",r.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,s=t.label,c=t.protocol,o=t.priority,this._assertSendDirection(),d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:c,priority:o},y.debug("sendDataChannel() [options:%o]",d),p=this._pc.createDataChannel(s,d),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%b.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,f=u.parse(l.sdp),h=f.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:f});case 15:return y.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:h}),m={type:"answer",sdp:this._remoteSdp.getSdp()},y.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),e.next=23,this._pc.setRemoteDescription(m);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),y.debug("receive() [trackId:%s, kind:%s]",r,n),s=r,c=n,this._remoteSdp.receive({mid:c,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),o={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=10,this._pc.setRemoteDescription(o);case 10:return e.next=12,this._pc.createAnswer();case 12:if(d=e.sent,p=u.parse(d.sdp),l=p.media.find((function(e){return String(e.mid)===c})),h.applyCodecParameters({offerRtpParameters:i,answerMediaObject:l}),d={type:"answer",sdp:u.write(p)},this._transportReady){e.next=20;break}return e.next=20,this._setupTransport({localDtlsRole:"client",localSdpObject:p});case 20:return y.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),e.next=23,this._pc.setLocalDescription(d);case 23:if(f=this._pc.getReceivers().find((function(e){return e.track&&e.track.id===s}))){e.next=26;break}throw new Error("new RTCRtpReceiver not");case 26:return this._mapRecvLocalIdInfo.set(s,{mid:c,rtpParameters:i,rtpReceiver:f}),e.abrupt("return",{localId:s,track:f.track,rtpReceiver:f});case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertRecvDirection(),y.debug("stopReceiving() [localId:%s]",t),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.mid,i=r.rtpParameters,this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:n,offerRtpParameters:i}),s={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=9,this._pc.setRemoteDescription(s);case 9:return e.next=11,this._pc.createAnswer();case 11:return c=e.sent,y.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=15,this._pc.setLocalDescription(c);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=i(a.mark((function e(t){var r,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.rtpReceiver){e.next=4;break}throw new Error("associated RTCRtpReceiver not found");case 4:return e.abrupt("return",n.getStats());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),s=r.streamId,c=r.ordered,o=r.maxPacketLifeTime,d=r.maxRetransmits,p={negotiated:!0,id:s,ordered:c,maxPacketLifeTime:o,maxRetransmits:d,protocol:i},y.debug("receiveDataChannel() [options:%o]",p),l=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=u.parse(h.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:m});case 19:return y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:l});case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setupTransport",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=u.parse(this._pc.localDescription.sdp)),(i=h.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Safari11"}}],[{key:"createFactory",value:function(){return function(){return new r}}}]),r}(v.HandlerInterface);t.Safari11=_},function(e,t,r){"use strict";var n=r(93),a=r(95),i=r(50),s=r(7),c=r(8),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(94),p=r(98),l=r(96),f=r(97),h=r(144),m=r(100),v=new u.Logger("Edge11"),g=function(e){o(r,e);var t=d(r);function r(){var e;return s(this,r),(e=t.call(this))._rtpSenders=new Map,e._rtpReceivers=new Map,e._nextSendLocalId=0,e._transportReady=!1,e}return c(r,[{key:"close",value:function(){v.debug("close()");try{this._iceGatherer.close()}catch(c){}try{this._iceTransport.stop()}catch(c){}try{this._dtlsTransport.stop()}catch(c){}var e,t=i(this._rtpSenders.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;try{r.stop()}catch(c){}}}catch(o){t.e(o)}finally{t.f()}var n,a=i(this._rtpReceivers.values());try{for(a.s();!(n=a.n()).done;){var s=n.value;try{s.stop()}catch(c){}}}catch(o){a.e(o)}finally{a.f()}}},{key:"getNativeRtpCapabilities",value:function(){var e=a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.debug("getNativeRtpCapabilities()"),e.abrupt("return",h.getCapabilities());case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getNativeSctpCapabilities",value:function(){var e=a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:{OS:0,MIS:0}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(e){e.direction;var t=e.iceParameters,r=e.iceCandidates,n=e.dtlsParameters,a=(e.sctpParameters,e.iceServers),i=e.iceTransportPolicy,s=(e.additionalSettings,e.proprietaryConstraints,e.extendedRtpCapabilities);v.debug("run()"),this._sendingRtpParametersByKind={audio:f.getSendingRtpParameters("audio",s),video:f.getSendingRtpParameters("video",s)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=n,this._cname="CNAME-".concat(l.generateRandomNumber()),this._setIceGatherer({iceServers:a,iceTransportPolicy:i}),this._setIceTransport(),this._setDtlsTransport()}},{key:"updateIceServers",value:function(){var e=a(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new p.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=a(n.mark((function e(t){var r,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.debug("restartIce()"),this._remoteIceParameters=t,this._transportReady){e.next=4;break}return e.abrupt("return");case 4:v.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,t,"controlling"),r=i(this._remoteIceCandidates);try{for(r.s();!(a=r.n()).done;)s=a.value,this._iceTransport.addRemoteCandidate(s)}catch(n){r.e(n)}finally{r.f()}this._iceTransport.addRemoteCandidate({});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._iceTransport.getStats());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=a(n.mark((function e(t){var r,a,s,c,o,d,u,p,m,g,y;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,a=t.encodings,t.codecOptions,s=t.codec,v.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),this._transportReady){e.next=5;break}return e.next=5,this._setupTransport({localDtlsRole:"server"});case 5:v.debug("send() | calling new RTCRtpSender()"),c=new RTCRtpSender(r,this._dtlsTransport),(o=l.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=f.reduceCodecs(o.codecs,s),d=o.codecs.some((function(e){return/.+\/rtx$/i.test(e.mimeType)})),a||(a=[{}]),u=i(a);try{for(u.s();!(p=u.n()).done;)(m=p.value).ssrc=l.generateRandomNumber(),d&&(m.rtx={ssrc:l.generateRandomNumber()})}catch(n){u.e(n)}finally{u.f()}return o.encodings=a,o.rtcp={cname:this._cname,reducedSize:!0,mux:!0},g=h.mangleRtpParameters(o),v.debug("send() | calling rtpSender.send() [params:%o]",g),e.next=19,c.send(g);case 19:return y=String(this._nextSendLocalId),this._nextSendLocalId++,this._rtpSenders.set(y,c),e.abrupt("return",{localId:y,rtpParameters:o,rtpSender:c});case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=a(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.debug("stopSending() [localId:%s]",t),r=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:this._rtpSenders.delete(t),e.prev=5,v.debug("stopSending() | calling rtpSender.stop()"),r.stop(),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(5),v.warn("stopSending() | rtpSender.stop() failed:%o",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[5,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=a(n.mark((function e(t,r){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r?v.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):v.debug("replaceTrack() [localId:%s, no track]",t),a=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:a.setTrack(r);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=a(n.mark((function e(t,r){var a,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),a=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:return(i=a.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=8,a.setParameters(i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=a(n.mark((function e(t,r){var a,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),a=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:return(i=a.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=Object.assign(Object.assign({},e),r)})),e.next=8,a.setParameters(i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=a(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._rtpSenders.get(t)){e.next=3;break}throw new Error("RTCRtpSender not found");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=a(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new p.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=a(n.mark((function e(t){var r,a,i,s,c,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.trackId,a=t.kind,i=t.rtpParameters,v.debug("receive() [trackId:%s, kind:%s]",r,a),this._transportReady){e.next=5;break}return e.next=5,this._setupTransport({localDtlsRole:"server"});case 5:return v.debug("receive() | calling new RTCRtpReceiver()"),(s=new RTCRtpReceiver(this._dtlsTransport,a)).addEventListener("error",(function(e){v.error('rtpReceiver "error" event [event:%o]',e)})),c=h.mangleRtpParameters(i),v.debug("receive() | calling rtpReceiver.receive() [params:%o]",c),e.next=12,s.receive(c);case 12:return o=r,this._rtpReceivers.set(o,s),e.abrupt("return",{localId:o,track:s.track,rtpReceiver:s});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=a(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.debug("stopReceiving() [localId:%s]",t),r=this._rtpReceivers.get(t)){e.next=4;break}throw new Error("RTCRtpReceiver not found");case 4:this._rtpReceivers.delete(t);try{v.debug("stopReceiving() | calling rtpReceiver.stop()"),r.stop()}catch(n){v.warn("stopReceiving() | rtpReceiver.stop() failed:%o",n)}case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=a(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._rtpReceivers.get(t)){e.next=3;break}throw new Error("RTCRtpReceiver not found");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=a(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new p.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setIceGatherer",value:function(e){var t=e.iceServers,r=e.iceTransportPolicy,n=new RTCIceGatherer({iceServers:t||[],gatherPolicy:r||"all"});n.addEventListener("error",(function(e){v.error('iceGatherer "error" event [event:%o]',e)}));try{n.gather()}catch(a){v.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",a.toString())}this._iceGatherer=n}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("icestatechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("candidatepairchange",(function(e){v.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=this,t=new RTCDtlsTransport(this._iceTransport);t.addEventListener("statechange",(function(){v.debug('dtlsTransport "statechange" event [state:%s]',t.state)})),t.addEventListener("dtlsstatechange",(function(){v.debug('dtlsTransport "dtlsstatechange" event [state:%s]',t.state),"closed"===t.state&&e.emit("@connectionstatechange","closed")})),t.addEventListener("error",(function(e){v.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=t}},{key:"_setupTransport",value:function(){var e=a(n.mark((function e(t){var r,a,s,c,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,v.debug("_setupTransport()"),(a=this._dtlsTransport.getLocalParameters()).role=r,e.next=6,this.safeEmitAsPromise("@connect",{dtlsParameters:a});case 6:this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling"),s=i(this._remoteIceCandidates);try{for(s.s();!(c=s.n()).done;)o=c.value,this._iceTransport.addRemoteCandidate(o)}catch(n){s.e(n)}finally{s.f()}this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm})),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"name",get:function(){return"Edge11"}}],[{key:"createFactory",value:function(){return function(){return new r}}}]),r}(m.HandlerInterface);t.Edge11=g},function(e,t,r){"use strict";var n=r(50);Object.defineProperty(t,"__esModule",{value:!0});var a=r(96);t.getCapabilities=function(){var e,t=RTCRtpReceiver.getCapabilities(),r=a.clone(t,{}),i=n(r.codecs);try{for(i.s();!(e=i.n()).done;){var s=e.value;if(s.channels=s.numChannels,delete s.numChannels,s.mimeType=s.mimeType||"".concat(s.kind,"/").concat(s.name),s.parameters){var c=s.parameters;c.apt&&(c.apt=Number(c.apt)),c["packetization-mode"]&&(c["packetization-mode"]=Number(c["packetization-mode"]))}var o,d=n(s.rtcpFeedback||[]);try{for(d.s();!(o=d.n()).done;){var u=o.value;u.parameter||(u.parameter="")}}catch(p){d.e(p)}finally{d.f()}}}catch(p){i.e(p)}finally{i.f()}return r},t.mangleRtpParameters=function(e){var t=a.clone(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);var r,i=n(t.codecs);try{for(i.s();!(r=i.n()).done;){var s=r.value;s.channels&&(s.numChannels=s.channels,delete s.channels),s.mimeType&&!s.name&&(s.name=s.mimeType.split("/")[1]),delete s.mimeType}}catch(c){i.e(c)}finally{i.f()}return t}},function(e,t,r){"use strict";var n=r(50),a=r(93),i=r(95),s=r(7),c=r(8),o=r(9),d=r(10);Object.defineProperty(t,"__esModule",{value:!0});var u=r(99),p=r(94),l=r(98),f=r(96),h=r(97),m=r(102),v=r(107),g=r(100),y=r(103),b=new p.Logger("ReactNative"),_={OS:1024,MIS:1024},w=function(e){o(r,e);var t=d(r);function r(){var e;return s(this,r),(e=t.call(this))._sendStream=new MediaStream,e._mapSendLocalIdTrack=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return c(r,[{key:"close",value:function(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:function(){var e=i(a.mark((function e(){var t,r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(a){}return n=u.parse(r.sdp),i=m.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(s){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNativeSctpCapabilities",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:_});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,a=e.iceCandidates,i=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,o=e.iceTransportPolicy,d=e.additionalSettings,u=e.proprietaryConstraints,p=e.extendedRtpCapabilities;b.debug("run()"),this._direction=r,this._remoteSdp=new y.RemoteSdp({iceParameters:n,iceCandidates:a,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:h.getSendingRtpParameters("audio",p),video:h.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:h.getSendingRemoteRtpParameters("audio",p),video:h.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:o||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},d),u),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=i(a.mark((function e(t){var r,n,i,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return s=e.sent,b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),e.next=27,this._pc.setLocalDescription(s);case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=i(a.mark((function e(t){var r,i,s,c,o,d,p,l,g,y,_,w,k,S;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,i=t.encodings,s=t.codecOptions,c=t.codec,this._assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),c&&b.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addStream(this._sendStream),e.next=8,this._pc.createOffer();case 8:if(o=e.sent,d=u.parse(o.sdp),(l=f.clone(this._sendingRtpParametersByKind[r.kind],{})).codecs=h.reduceCodecs(l.codecs),(g=f.clone(this._sendingRemoteRtpParametersByKind[r.kind],{})).codecs=h.reduceCodecs(g.codecs),this._transportReady){e.next=17;break}return e.next=17,this._setupTransport({localDtlsRole:"server",localSdpObject:d});case 17:return"video"===r.kind&&i&&i.length>1&&(b.debug("send() | enabling simulcast"),d=u.parse(o.sdp),p=d.media.find((function(e){return"video"===e.type})),v.addLegacySimulcast({offerMediaObject:p,track:r,numStreams:i.length}),o={type:"offer",sdp:u.write(d)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),e.next=21,this._pc.setLocalDescription(o);case 21:if(d=u.parse(this._pc.localDescription.sdp),p=d.media.find((function(e){return e.type===r.kind})),l.rtcp.cname=m.getCname({offerMediaObject:p}),l.encodings=v.getRtpEncodings({offerMediaObject:p,track:r}),i)for(y=0;y<l.encodings.length;++y)i[y]&&Object.assign(l.encodings[y],i[y]);if(l.encodings.length>1&&("video/vp8"===l.codecs[0].mimeType.toLowerCase()||"video/h264"===l.codecs[0].mimeType.toLowerCase())){_=n(l.encodings);try{for(_.s();!(w=_.n()).done;)w.value.scalabilityMode="S1T3"}catch(a){_.e(a)}finally{_.f()}}return this._remoteSdp.send({offerMediaObject:p,offerRtpParameters:l,answerRtpParameters:g,codecOptions:s}),k={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),e.next=32,this._pc.setRemoteDescription(k);case 32:return S=String(this._nextSendLocalId),this._nextSendLocalId++,this._mapSendLocalIdTrack.set(S,r),e.abrupt("return",{localId:S,rtpParameters:l});case 36:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),b.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdTrack.get(t)){e.next=5;break}throw new Error("track not found");case 5:return this._mapSendLocalIdTrack.delete(t),this._sendStream.removeTrack(r),this._pc.addStream(this._sendStream),e.next=10,this._pc.createOffer();case 10:return n=e.sent,b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return b.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return i={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=29,this._pc.setRemoteDescription(i);case 29:case"end":return e.stop()}}),e,this,[[12,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=i(a.mark((function e(t,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=i(a.mark((function e(t,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=i(a.mark((function e(t,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=i(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m,v;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,s=t.label,c=t.protocol,o=t.priority,this._assertSendDirection(),d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:c,priority:o},b.debug("sendDataChannel() [options:%o]",d),p=this._pc.createDataChannel(s,d),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(l=e.sent,f=u.parse(l.sdp),h=f.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:f});case 15:return b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),e.next=18,this._pc.setLocalDescription(l);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:h}),m={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",m),e.next=23,this._pc.setRemoteDescription(m);case 23:this._hasDataChannelMediaSection=!0;case 24:return v={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits},e.abrupt("return",{dataChannel:p,sctpStreamParameters:v});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,h,v,g;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),b.debug("receive() [trackId:%s, kind:%s]",r,n),s=r,c=n,o=i.rtcp.cname,b.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),o+="-hack-".concat(f.generateRandomNumber()),this._remoteSdp.receive({mid:c,kind:n,offerRtpParameters:i,streamId:o,trackId:r}),d={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),e.next=13,this._pc.setRemoteDescription(d);case 13:return e.next=15,this._pc.createAnswer();case 15:if(p=e.sent,l=u.parse(p.sdp),h=l.media.find((function(e){return String(e.mid)===c})),m.applyCodecParameters({offerRtpParameters:i,answerMediaObject:h}),p={type:"answer",sdp:u.write(l)},this._transportReady){e.next=23;break}return e.next=23,this._setupTransport({localDtlsRole:"client",localSdpObject:l});case 23:return b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",p),e.next=26,this._pc.setLocalDescription(p);case 26:if(v=this._pc.getRemoteStreams().find((function(e){return e.id===o})),g=v.getTrackById(s)){e.next=30;break}throw new Error("remote track not found");case 30:return this._mapRecvLocalIdInfo.set(s,{mid:c,rtpParameters:i}),e.abrupt("return",{localId:s,track:g});case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertRecvDirection(),b.debug("stopReceiving() [localId:%s]",t),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.mid,i=r.rtpParameters,this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:n,offerRtpParameters:i}),s={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=9,this._pc.setRemoteDescription(s);case 9:return e.next=11,this._pc.createAnswer();case 11:return c=e.sent,b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),e.next=15,this._pc.setLocalDescription(c);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=i(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new l.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=i(a.mark((function e(t){var r,n,i,s,c,o,d,p,l,f,h,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),s=r.streamId,c=r.ordered,o=r.maxPacketLifeTime,d=r.maxRetransmits,p={negotiated:!0,id:s,ordered:c,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:d,protocol:i},b.debug("receiveDataChannel() [options:%o]",p),l=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),f={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),e.next=12,this._pc.setRemoteDescription(f);case 12:return e.next=14,this._pc.createAnswer();case 14:if(h=e.sent,this._transportReady){e.next=19;break}return m=u.parse(h.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:m});case 19:return b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.next=22,this._pc.setLocalDescription(h);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:l});case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setupTransport",value:function(){var e=i(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=u.parse(this._pc.localDescription.sdp)),(i=m.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"ReactNative"}}],[{key:"createFactory",value:function(){return function(){return new r}}}]),r}(g.HandlerInterface);t.ReactNative=w},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(112)),n(r(114)),n(r(115)),n(r(116)),n(r(117)),n(r(118)),n(r(100)),n(r(98))}])]);
//# sourceMappingURL=0.474781e3.chunk.js.map